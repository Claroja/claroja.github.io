import{_ as n}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as a,c as s,e as t}from"./app-XqA98pG8.js";const e={},o=t(`<h1 id="saveloadrun-tutorial" tabindex="-1"><a class="header-anchor" href="#saveloadrun-tutorial" aria-hidden="true">#</a> saveloadrun_tutorial</h1><h2 id="saving-and-loading-model-weights" tabindex="-1"><a class="header-anchor" href="#saving-and-loading-model-weights" aria-hidden="true">#</a> Saving and Loading Model Weights</h2><p>只保留state dictionary, 既<code>state_dict</code></p><ol><li>保存</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>model <span class="token operator">=</span> models<span class="token punctuation">.</span>vgg16<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;model_weights.pth&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>载入, 需要先实例化网络对象</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>model <span class="token operator">=</span> models<span class="token punctuation">.</span>vgg16<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># we do not specify pretrained=True, i.e. do not load default weights</span>
model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&#39;model_weights.pth&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="saving-and-loading-models-with-shapes" tabindex="-1"><a class="header-anchor" href="#saving-and-loading-models-with-shapes" aria-hidden="true">#</a> Saving and Loading Models with Shapes</h2><p>可以将网络结构和权重一起保存</p><ol><li>保存</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">&#39;model.pth&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>载入</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&#39;model.pth&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="也可以保存为onnx" tabindex="-1"><a class="header-anchor" href="#也可以保存为onnx" aria-hidden="true">#</a> 也可以保存为ONNX</h2><p>ONNX(Open Neural Network Exchange), 由于在导出ONNX时需要执行一遍网络, 所以要创建一个输入.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>input_image <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
onnx<span class="token punctuation">.</span>export<span class="token punctuation">(</span>model<span class="token punctuation">,</span> input_image<span class="token punctuation">,</span> <span class="token string">&#39;model.onnx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>参考: https://pytorch.org/tutorials/beginner/basics/saveloadrun_tutorial.html https://pytorch.org/tutorials/beginner/basics/saveloadrun_tutorial.html</p>`,17),p=[o];function i(l,c){return a(),s("div",null,p)}const r=n(e,[["render",i],["__file","basics_saveloadrun_tutorial.html.vue"]]);export{r as default};
