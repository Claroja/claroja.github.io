import{_ as n}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as s,c as a,d as t}from"./app-j3zK2x6_.js";const e="/assets/1-zncaYfCw.png",p="/assets/2-NTAGoDL5.png",o="/assets/3-xw7dj1fi.png",c={},i=t('<h1 id="用户级io" tabindex="-1"><a class="header-anchor" href="#用户级io" aria-hidden="true">#</a> 用户级IO</h1><p>用户级IO对系统级IO的API进行高级的封装.</p><h2 id="内核缓冲区-流" tabindex="-1"><a class="header-anchor" href="#内核缓冲区-流" aria-hidden="true">#</a> 内核缓冲区:流</h2><p>流是<code>open</code>,<code>socket</code>,<code>pipe</code>等操作的内核对象,内核缓冲区就是这样的流 read:从流中读数据 write:向流中写入数据</p><p>假设有一个管道,进程A为管道的写入方,B为管道的读出方 1.内核缓冲区空 B作为读出方,阻塞</p><p>2.内核缓冲区非空 当A写入数据,内核缓冲区给B发信号,唤醒B,B就可以读了</p><p>3.内核缓冲区满 假设B未开启,A一直往内核缓冲区写,写满后A.内核缓冲区发信号给A,A阻塞 B读数据,内核缓冲区变为非空状态,内核缓冲区向A发送信号,A继续写</p><h2 id="缓冲类型" tabindex="-1"><a class="header-anchor" href="#缓冲类型" aria-hidden="true">#</a> 缓冲类型</h2><ul><li>全缓冲 缓冲区满时才会嗲用时间的文件IO(除了终端设备的文件流,其他基本都是全缓冲)</li><li>行缓冲 遇到换行符\\n才会调用文件IO.(终端设备就是行缓冲,如标准输入和标准输出,但是如果标准输入和输出重定向到某个文件时,就是全缓冲)</li><li>无缓冲 直接调用文件IO(标准错误就是无缓冲)</li></ul><h2 id="open" tabindex="-1"><a class="header-anchor" href="#open" aria-hidden="true">#</a> open</h2><p>1.<code>open</code>函数返回文件描述符, 2.<code>write</code>写入缓冲区 3.<code>flush</code>将缓冲区内容写入硬盘文件 4.当内核缓冲区满后,自动调用<code>flush</code>,写入硬盘文件 <img src="'+e+'" alt="" loading="lazy"></p><h2 id="pipe-fifo-mmap" tabindex="-1"><a class="header-anchor" href="#pipe-fifo-mmap" aria-hidden="true">#</a> pipe/fifo/mmap</h2><p>1.进程1使用<code>pipe/fifo/mmap</code>创建描述符,写入(如果写满会阻塞) 2.进程2使用相同的方法创建描述符,读取(如果空会堵塞) 3.区别于<code>open</code>,<code>flush</code>相当于进程2的<code>read</code>,因为写入磁盘是被动的 <img src="'+p+'" alt="" loading="lazy"></p><h2 id="socket" tabindex="-1"><a class="header-anchor" href="#socket" aria-hidden="true">#</a> socket</h2><p>1.<code>socket1</code>使用<code>pipe/fifo/mmap</code>创建描述符,写入(如果写满会阻塞) 2.<code>socket2</code>使用相同的方法创建描述符,读取(如果空会堵塞) <img src="'+o+`" alt="" loading="lazy"></p><h2 id="多文件描述符操作" tabindex="-1"><a class="header-anchor" href="#多文件描述符操作" aria-hidden="true">#</a> 多文件描述符操作</h2><h3 id="忙轮询" tabindex="-1"><a class="header-anchor" href="#忙轮询" aria-hidden="true">#</a> 忙轮询</h3><p>将所有的流从头到尾询问一遍,如果有数据,就可以处理,但是如果都没数据就会浪费cpu</p><h3 id="无差别轮询-select-poll" tabindex="-1"><a class="header-anchor" href="#无差别轮询-select-poll" aria-hidden="true">#</a> 无差别轮询 select/poll</h3><p>1.没有I/O产生,程序阻塞在select/poll处,有一个或多个I/O时间,从阻塞中醒来,轮询一遍所有的流 2.使用select我们有O(n)无差别轮询复杂度,当监听的流变多时,效率差 3.select最大文件描述符1024,poll没有最大限制</p><h3 id="回调-epoll" tabindex="-1"><a class="header-anchor" href="#回调-epoll" aria-hidden="true">#</a> 回调 epoll</h3><p>1.没有最大文件描述限制 2.不是轮询方式,有活跃可用的文件描述符调用callback函数,跟踪连接数无关,复杂度O(1)</p><h2 id="c语言" tabindex="-1"><a class="header-anchor" href="#c语言" aria-hidden="true">#</a> C语言</h2><p>声明FILE结构体类型的信息包含在头文件“stdio.h”中，一般设置一个指向FILE类型变量的指针变量，然后通过它来引用这些FILE类型变量。通过文件指针就可对它所指的文件进行各种操作。</p><p>基本上每种语言都是这样,文本文件可以显示给我们看,而二进制文件是每种语言所特有的,比如python的pickle,java的objectwrite</p><p>有三个特殊的文件指针由系统默认打开，用户无需定义即可直接使用: stdin： 标准输入，默认为当前终端（键盘），我们使用的scanf、getchar函数默认从此终端获得数据。 stdout：标准输出，默认为当前终端（屏幕），我们使用的printf、puts函数默认输出信息到此终端。 stderr：标准出错，默认为当前终端（屏幕），我们使用的perror函数默认输出信息到此终端。</p><p>C语言中，EOF表示文件结束符(end of file)。在while循环中以EOF作为文件结束标志，这种以EOF作为文件结束标志的文件，必须是文本文件。在文本文件中，数据都是以字符的ASCII代码值的形式存放。我们知道，ASCII代码值的范围是0~127，不可能出现-1，因此可以用EOF作为文件结束标志。</p><p>当把数据以二进制形式存放到文件中时，就会有-1值的出现，因此不能采用EOF作为二进制文件的结束标志。为解决这一个问题，ANSI C提供一个feof函数，用来判断文件是否结束。feof函数既可用以判断二进制文件又可用以判断文本文件。</p><h3 id="打开和关闭文件" tabindex="-1"><a class="header-anchor" href="#打开和关闭文件" aria-hidden="true">#</a> 打开和关闭文件</h3><h4 id="fopen" tabindex="-1"><a class="header-anchor" href="#fopen" aria-hidden="true">#</a> fopen</h4><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>FILE <span class="token operator">*</span> <span class="token function">fopen</span> <span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> mode <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>filename</td><td>C字符串,文件名</td></tr><tr><td>mode</td><td></td></tr></tbody></table><table><thead><tr><th>mode</th><th>描述</th></tr></thead><tbody><tr><td>&quot;r&quot;</td><td>read: Open file for input operations. The file must exist.</td></tr><tr><td>&quot;w&quot;</td><td>write: 创建新文件,如果已存在,则覆盖</td></tr><tr><td>&quot;a&quot;</td><td>append: 追加,如果文件不存在,则创建.光标在末尾,忽略<code>fseek, fsetpos, rewind</code></td></tr><tr><td>&quot;r+&quot;</td><td>read/update: Open a file for update (both for input and output). The file must exist.</td></tr><tr><td>&quot;w+&quot;</td><td>write/update: 创建新文件,如果已存在,则覆盖</td></tr><tr><td>&quot;a+&quot;</td><td>append/update: Open a file for update (both for input and output) with all output operations writing data at the end of the file. Repositioning operations (fseek, fsetpos, rewind) affects the next input operations, but output operations move the position back to the end of file. The file is created if it does not exist.</td></tr></tbody></table><ol><li>mode:使用<code>b</code>来处理二进制文件,如&quot;rb&quot;,&quot;wb&quot;,&quot;ab&quot;,&quot;r+b&quot;,&quot;w+b&quot;</li><li>mode:C2011中加了&#39;x&#39;,来确认文件是否存在,而不是直接覆盖文件</li><li>mode:&quot;+&quot;,文件stream在写后的读操作,会先调用flushed(\`fflush)或repositioned((fseek, fsetpos, rewind)</li><li>mode:&quot;+&quot;,读后的写操作,需要先调用<code>fseek, fsetpos, rewind</code></li></ol><p>注意: 为什么会有<code>b</code>模式? 实际上，fopen()的 b 标志不但可以打开二进制文件，还可以打开文本文件，同样，不带 b 标志也可以打开文本文件。既然这样，为什么还要区分两种打开方式呢？ 因为这两种方式在读写<code>文本</code>文件时的操作是不一样的。 之所以 C 语言要区分“文本文件”和“二进制文件”这两个概念，是因为每个操作系统存储换行符的方式不一样。类 UNIX 系统（包括 Linux、BSD、现代 macOS 等）用 LF &quot;\\n&quot; 表示换行，DOS 和 Windows 系统使用 CRLF &quot;\\r\\n&quot; 表示换行，Classic Mac OS 使用 CR &quot;\\r&quot; 表示换行。这个要是错了，在一些程序中，可能会解析成错误的结果。具体的: 1、使用二进制方式进行读文本文件时，会原封不动的读出全部的内容，写文件的时候，会把内存缓冲区的内容原封不动的写到文件中。 2、使用文本方式进行读文本文件时，会将回车换行符号CRLF(0x0D OxOA)全部转换成单个的换行符号LF(OxOA)，写文件的时候，会将换行符号LF( OxOA)全部转换成回车换行符号CRLF(0x0D OxOA)</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;1.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//以文本方式写文件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span><span class="token string">&quot;%s%s\\n&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;34&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//行尾加回车符:\\n</span>
		<span class="token punctuation">}</span>
		<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		fp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用编辑器, 显示换行符, 可以看到在写文件时，<code>\\n (LF)</code>转换成了 <code>\\r\\n (CR LF)</code>。 所以c语言中的二进制<code>b</code>和文本<code>t</code>模式, 仅是换行符的区别. 其他语言则不然, 比如在<code>python</code>中, 二进制<code>b</code>是和c语言一样的, 但是<code>t</code>模式下, <code>python</code>还增加了<code>encoding</code>参数, 用来编解码GBK, utf等.</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE <span class="token operator">*</span> pFile<span class="token punctuation">;</span>
	pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">&quot;fopen example&quot;</span><span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fclose" tabindex="-1"><a class="header-anchor" href="#fclose" aria-hidden="true">#</a> fclose</h4><ol><li>关闭文件,在之前刷新缓冲区</li></ol><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>stream</td><td>FILE object</td></tr></tbody></table><table><thead><tr><th>返回</th><th>描述</th></tr></thead><tbody><tr><td>成功</td><td>返回0</td></tr><tr><td>失败</td><td>EOF(-1)</td></tr></tbody></table><h4 id="freopen" tabindex="-1"><a class="header-anchor" href="#freopen" aria-hidden="true">#</a> freopen</h4><ol><li>重定向已经打开的流</li></ol><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>FILE <span class="token operator">*</span><span class="token function">freopen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>filename</td><td>C字符串,要打开的文件名</td></tr><tr><td>mode</td><td>C字符串</td></tr><tr><td>stream</td><td>FILE指针,要被重新打开的流</td></tr></tbody></table><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">freopen</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\\n&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;将标准输出的流重定向到文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//printf本应该打印在控制台,现在写入了文件</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="操作文件内容" tabindex="-1"><a class="header-anchor" href="#操作文件内容" aria-hidden="true">#</a> 操作文件内容</h3><h4 id="fread" tabindex="-1"><a class="header-anchor" href="#fread" aria-hidden="true">#</a> fread</h4><p><code>size_t fread ( void * ptr, size_t size, size_t count, FILE * stream )</code> Read block of data from stream</p><ol><li>fread()──从fp所指向文件的当前位置开始，一次读入size个字节，重复count次，并将读入的数据存放到从buffer开始的内存中；</li><li>读写的是数据块,既<code>size_t size</code> 参数|描述 --|-- ptr|block of memory with a size of at least (size<em>count) bytes,converted to a void</em> size|Size, in bytes, of each element to be read. count|Number of elements, each one with a size of size bytes. stream|Pointer to a FILE object</li></ol><table><thead><tr><th>返回</th><th>描述</th></tr></thead><tbody><tr><td>成功</td><td>返回count</td></tr></tbody></table><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//一定要初始化数组,不然会很&#39;烫&#39;(声明数组时,内存空间可能被其他程序修改过)</span>
	<span class="token function">fread</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\\n&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fwrite" tabindex="-1"><a class="header-anchor" href="#fwrite" aria-hidden="true">#</a> fwrite</h3><p>和fread对应</p><h2 id="int-类型读写" tabindex="-1"><a class="header-anchor" href="#int-类型读写" aria-hidden="true">#</a> int 类型读写</h2><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE <span class="token operator">*</span> pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wb+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> wbuffer<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">fwrite</span><span class="token punctuation">(</span>wbuffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此时文件position已经在1字节后</span>
	<span class="token keyword">int</span> rbuffer<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">fread</span><span class="token punctuation">(</span>rbuffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\\n&quot;</span><span class="token punctuation">,</span> rbuffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="结构体读写" tabindex="-1"><a class="header-anchor" href="#结构体读写" aria-hidden="true">#</a> 结构体读写</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>person<span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE <span class="token operator">*</span> pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wb+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	person wper<span class="token punctuation">;</span>
	wper<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>wper<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 字符串数组</span>
	<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wper<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此时文件position已经在1字节后</span>
	
	person rper<span class="token punctuation">;</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rper<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %s\\n&quot;</span><span class="token punctuation">,</span> rper<span class="token punctuation">.</span>age<span class="token punctuation">,</span> rper<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fseek" tabindex="-1"><a class="header-anchor" href="#fseek" aria-hidden="true">#</a> fseek</h4><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>fgetpos</td><td>Get current position in stream (function )</td></tr><tr><td>fsetpos</td><td>Set position indicator of stream (function )</td></tr><tr><td>ftell</td><td>Get current position in stream (function )</td></tr><tr><td>fseek</td><td>Reposition stream position indicator (function )</td></tr><tr><td>rewind</td><td>Set position of stream to the beginning (function )</td></tr></tbody></table><p>ftell() 和 fseek() 用长整型表示文件内的偏移 (位置) fgetpos() 和 fsetpos() 函数使用 了一个特殊的类型定义 fpos_t 来表示偏移量</p><h3 id="buffer" tabindex="-1"><a class="header-anchor" href="#buffer" aria-hidden="true">#</a> buffer</h3><p>ANSI C标准采用“缓冲文件系统”处理数据文件。所谓缓冲文件系统是指系统自动地在内存区为程序中每一个正在使用的文件开辟一个文件缓冲区从内存向磁盘输出数据必须先送到内存中的缓冲区，装满缓冲区后才一起送到磁盘去。 如果从磁盘向计算机读入数据，则一次从磁盘文件将一批数据输入到内存缓冲区(充满缓冲区)，然后再从缓冲区逐个地将数据送到程序数据区(给程序变量) 。</p><h4 id="setbuf" tabindex="-1"><a class="header-anchor" href="#setbuf" aria-hidden="true">#</a> setbuf</h4><p><code>void setbuf ( FILE * stream, char * buffer );</code> Set stream buffer</p><ol><li>设置文件描述符的缓冲区大小</li><li>stream buffer是一个 block of data,在i/o操作和 physical file(文件) 之间</li><li>output buffers,写出:数据会放在buffer区,直到填满,然后会flushed(发送给 物理文件并清空buffer区)</li><li>input buffers,也是如此</li><li>Stream buffers can be explicitly flushed by calling <code>fflush</code>, <code>fclose</code> and <code>freopen</code>或者程序terminates normally(正常终止)会自动调用<code>fllush</code></li><li>所有打开的文件都默认带有<code>buffer</code></li><li>stdin and stdout are fully buffered by default if they are known to not refer to an interactive . Otherwise, they may either be line buffered or unbuffered by default</li><li>通过setvbuf 改变缓冲方式</li></ol><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>stream</td><td>FILE object</td></tr><tr><td>buffer</td><td>存放buffer的数组</td></tr></tbody></table><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;缓冲区大小是%d字节\\n&quot;</span><span class="token punctuation">,</span> BUFSIZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//屏幕此时没有输出,因为存在buf数组里</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//屏幕输出</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="setvbuf" tabindex="-1"><a class="header-anchor" href="#setvbuf" aria-hidden="true">#</a> setvbuf</h4><p><code>int setvbuf ( FILE * stream, char * buffer, int mode, size_t size );</code>Change stream buffering</p><ol><li>设置缓冲方式(Full buffering,Line buffering,No buffering)</li></ol><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>stream</td><td>Pointer to a FILE object</td></tr><tr><td>buffer</td><td>User allocated buffer. Shall be at least size bytes long.如果空,会自动设置默认buffer(BUFSIZ)</td></tr><tr><td>mode</td><td>三种</td></tr><tr><td>size</td><td>Buffer size, in bytes.</td></tr></tbody></table><table><thead><tr><th>mode</th><th>描述</th></tr></thead><tbody><tr><td>_IOFBF</td><td>Full buffering,写出:buffer区间满,刷新,读入:buffer空,刷新</td></tr><tr><td>_IOLBF</td><td>Line buffering,写出:buffer区满或碰到换行符,刷新,读入:buffer空,或换行符,刷新</td></tr><tr><td>_IONBF</td><td>No buffering,没有缓冲区,buffer and size参数被忽略</td></tr></tbody></table><table><thead><tr><th>返回</th><th>描述</th></tr></thead><tbody><tr><td>成功</td><td>返回0</td></tr><tr><td>失败</td><td>非0</td></tr></tbody></table><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//直接输出到屏幕,不需要刷新缓冲区</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fflush" tabindex="-1"><a class="header-anchor" href="#fflush" aria-hidden="true">#</a> fflush</h4><p><code>int fflush ( FILE * stream );</code> Flush stream 功能：更新缓冲区，让缓冲区的数据立马写到文件中。 参数： stream：文件指针 返回值： 成功：0 失败：-1</p><h3 id="scan-printf" tabindex="-1"><a class="header-anchor" href="#scan-printf" aria-hidden="true">#</a> scan&amp;printf</h3><h4 id="scanf" tabindex="-1"><a class="header-anchor" href="#scanf" aria-hidden="true">#</a> scanf</h4><ol><li>scanf()第一个参数是一个都带有格式的控制串</li><li>.第二个参数是地址(address).</li><li>从键盘输入一切数据(数字、字母，还是空格、回车、Tab)都会放入缓冲区(队列),按回车后读取缓冲区内容</li><li>对 %d 而言，空格、回车、Tab 键都是区分数据与数据的分隔符,如果碰到不会取用,而是跳过知道取到十进制整数”为止.</li><li>%d 遇到字母，那么它不会跳过也不会取用，而是直接从缓冲区跳出,所以下面的程序会打印变量i的未初始化的值</li><li>%c，那么任何数据都会被当作一个字符，不管是数字还是空格、回车、Tab 键它都会取回。</li><li>在读入数字时,scanf()跳过空白字符(空格,换行符和跳格符),但在读入字符时,不会跳过空白字符.</li></ol><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable<span class="token operator">:</span><span class="token number">4996</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&amp;i 表示变量 i 的地址，&amp;是取地址符</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i = %d\\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="printf" tabindex="-1"><a class="header-anchor" href="#printf" aria-hidden="true">#</a> printf</h4><h2 id="python" tabindex="-1"><a class="header-anchor" href="#python" aria-hidden="true">#</a> python</h2><h3 id="打开和关闭文件-1" tabindex="-1"><a class="header-anchor" href="#打开和关闭文件-1" aria-hidden="true">#</a> 打开和关闭文件</h3><h4 id="open-1" tabindex="-1"><a class="header-anchor" href="#open-1" aria-hidden="true">#</a> open</h4><ol><li>二进制读写 使用<code>open()</code>函数, 二进制字节对象,不会执行编码,解码和换行符转换操作.</li><li>硬盘二进制写入</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;file.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span>   <span class="token comment"># 硬盘中, 写入字节</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>硬盘二进制读取</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;myfile.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 硬盘中, 读取字节</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>文本读写</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;hello.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span>

f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Hello Python!\\n&quot;</span><span class="token punctuation">)</span>

<span class="token comment">## f.flush()  # 如果不冲洗,则硬盘没有内容\`hello Python\`还保存在内存的缓冲区,调用后才写入磁盘</span>
<span class="token comment">## f.close()  # close方法先调用flush()方法,再写入</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="close" tabindex="-1"><a class="header-anchor" href="#close" aria-hidden="true">#</a> close</h4><p><code>f.close()</code> # close方法先调用flush()方法,再写入</p><h3 id="操作文件内容-1" tabindex="-1"><a class="header-anchor" href="#操作文件内容-1" aria-hidden="true">#</a> 操作文件内容</h3><h4 id="read" tabindex="-1"><a class="header-anchor" href="#read" aria-hidden="true">#</a> read</h4><h4 id="write" tabindex="-1"><a class="header-anchor" href="#write" aria-hidden="true">#</a> write</h4><h3 id="bytesio" tabindex="-1"><a class="header-anchor" href="#bytesio" aria-hidden="true">#</a> BytesIO</h3><p>省略了保存到硬盘的步骤, 相当于在内存中虚拟了硬盘的存储空间</p><ol><li>内存二进制写入</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>
<span class="token comment">## 保存字符串的二进制</span>
binaryObject <span class="token operator">=</span> <span class="token string">&#39;王&#39;</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 将字符转换为二进制对象</span>
bytes_io <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>binaryObject<span class="token punctuation">)</span>  <span class="token comment"># 将二进制</span>


<span class="token comment">## 保存matplotlib二进制图片</span>
buf <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#另一种写入BytesIO的方法</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token builtin">format</span><span class="token operator">=</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span> <span class="token comment"># 保存图片二进制</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>内存二进制读取 <code>BytesIO对象</code>和<code>open()</code>函数返回的<code>file对象</code>有相同的<code>read</code>和<code>write</code>函数</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 字符串二进制读取</span>
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO <span class="token comment"># 和StringIO类似</span>
bytes_io <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token string">&#39;王&#39;</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bytes_io<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>


<span class="token comment">## 图片二进制读取</span>
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
i <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>binaryImgObject<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="应用" tabindex="-1"><a class="header-anchor" href="#应用" aria-hidden="true">#</a> 应用</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> jinja2 <span class="token keyword">import</span> Template<span class="token punctuation">,</span>FileSystemLoader<span class="token punctuation">,</span>Environment
env <span class="token operator">=</span> Environment<span class="token punctuation">(</span>loader<span class="token operator">=</span>FileSystemLoader<span class="token punctuation">(</span><span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
template <span class="token operator">=</span> env<span class="token punctuation">.</span>get_template<span class="token punctuation">(</span><span class="token string">&quot;./test.html&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
buf <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#另一种写入BytesIO的方法</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token builtin">format</span><span class="token operator">=</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span> <span class="token comment">#另一种写入BytesIO的方法</span>
<span class="token keyword">import</span> base64
data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>buf<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token string">&quot;data:image/png;base64,&quot;</span> <span class="token operator">+</span> data
temp_render <span class="token operator">=</span> template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>name<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>temp_render<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ name }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="stringio" tabindex="-1"><a class="header-anchor" href="#stringio" aria-hidden="true">#</a> StringIO</h3><p>内存读写</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
string_io <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token string">&quot;hello\\nworld&quot;</span><span class="token punctuation">)</span>
string_io<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获得行</span>
string_io<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 获得存储的值</span>

<span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
string_io <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
string_io<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
string_io<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>
string_io<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 回到起始位置,每次写入指针都会后移动</span>
string_io<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="应用-1" tabindex="-1"><a class="header-anchor" href="#应用-1" aria-hidden="true">#</a> 应用</h2><p>Text I/O 对象 StringIO可以当成open打开文件返回的对象来使用</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;myfile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span><span class="token string">&quot;some initial text data&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> io
f <span class="token operator">=</span> io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span><span class="token string">&quot;id,name\\n1,brian\\n2,amanda\\n3,zoey\\n&quot;</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token comment"># pandas takes a file path or a file-like object</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考: http://www.gnu.org/software/libc/manual/html_node/I_002fO-on-Streams.html#I_002fO-on-Streams http://www.cplusplus.com/reference/cstdio/ http://www.gnu.org/software/libc/manual/html_node/I_002fO-on-Streams.html#I_002fO-on-Streams http://blog.sina.com.cn/s/blog_ade902fe0101l4yd.html http://www.cplusplus.com/reference/cstdio/ http://www.gnu.org/software/libc/manual/html_node/I_002fO-on-Streams.html#I_002fO-on-Streams http://www.gnu.org/software/libc/manual/html_node/I_002fO-on-Streams.html#I_002fO-on-Streams http://c.biancheng.net/view/159.html https://docs.python.org/3/library/functions.html#open https://www.cnblogs.com/maociping/p/5132583.html https://www.cnblogs.com/gregoryli/p/7899010.html https://stackoverflow.com/questions/7996479/what-is-stringio-in-python-used-for-in-reality</p>`,114),l=[i];function u(r,d){return s(),a("div",null,l)}const v=n(c,[["render",u],["__file","io_用户级IO.html.vue"]]);export{v as default};
