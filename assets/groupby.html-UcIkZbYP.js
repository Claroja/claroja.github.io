import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o,c as e,d as u,w as c,a as n,b as s,e as i}from"./app-0JgdiRQ-.js";const l={},d=n("h1",{id:"groupby",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#groupby","aria-hidden":"true"},"#"),s(" groupby")],-1),r=i(`<h2 id="数据准备" tabindex="-1"><a class="header-anchor" href="#数据准备" aria-hidden="true">#</a> 数据准备</h2><table><thead><tr><th>id</th><th>account</th><th>name</th><th>order_id</th><th>sku</th><th>quantity</th><th>unit_price</th><th>ext_price</th></tr></thead><tbody><tr><td>0</td><td>383080</td><td>Will LLC</td><td>10001</td><td>B1-20000</td><td>7</td><td>33.69</td><td>235.83</td></tr><tr><td>1</td><td>383080</td><td>Will LLC</td><td>10001</td><td>S1-27722</td><td>11</td><td>21.12</td><td>232.32</td></tr><tr><td>2</td><td>383080</td><td>Will LLC</td><td>10001</td><td>B1-86481</td><td>3</td><td>35.99</td><td>107.97</td></tr><tr><td>3</td><td>412290</td><td>Jerde-Hilpert</td><td>10005</td><td>S1-06532</td><td>48</td><td>55.82</td><td>2679.36</td></tr><tr><td>4</td><td>412290</td><td>Jerde-Hilpert</td><td>10005</td><td>S1-82801</td><td>21</td><td>13.62</td><td>286.02</td></tr><tr><td>5</td><td>412290</td><td>Jerde-Hilpert</td><td>10005</td><td>S1-06532</td><td>9</td><td>92.55</td><td>832.95</td></tr><tr><td>6</td><td>412290</td><td>Jerde-Hilpert</td><td>10005</td><td>S1-47412</td><td>44</td><td>78.91</td><td>3472.04</td></tr><tr><td>7</td><td>412290</td><td>Jerde-Hilpert</td><td>10005</td><td>S1-27722</td><td>36</td><td>25.42</td><td>915.12</td></tr><tr><td>8</td><td>218895</td><td>Kulas Inc</td><td>10006</td><td>S1-27722</td><td>32</td><td>95.66</td><td>3061.12</td></tr><tr><td>9</td><td>218895</td><td>Kulas Inc</td><td>10006</td><td>B1-33087</td><td>23</td><td>22.55</td><td>518.65</td></tr><tr><td>10</td><td>218895</td><td>Kulas Inc</td><td>10006</td><td>B1-33364</td><td>3</td><td>72.30</td><td>216.90</td></tr><tr><td>11</td><td>218895</td><td>Kulas Inc</td><td>10006</td><td>B1-20000</td><td>-1</td><td>72.18</td><td>-72.18</td></tr></tbody></table><p>字段解释:</p><ol><li><code>id</code>: 订单的唯一标识</li><li><code>account</code>: 用户的账号</li><li><code>name</code>: 用户的名称</li><li><code>order_id</code>: 订单id(1个订单可以由多个商品)</li><li><code>sku</code>: 商品名称</li><li><code>quantity</code>: 商品的个数</li><li><code>unit_price</code>: 每个商品的价格</li><li><code>ext_price</code>: <code>unit_price</code> * <code>quantity</code></li></ol><p>可以看到有三个不同的订单(orders), 10001,10005和10006. 每个订单有多种商品(sku).</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;account&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">383080</span><span class="token punctuation">,</span><span class="token number">383080</span><span class="token punctuation">,</span><span class="token number">383080</span><span class="token punctuation">,</span><span class="token number">412290</span><span class="token punctuation">,</span><span class="token number">412290</span><span class="token punctuation">,</span><span class="token number">412290</span><span class="token punctuation">,</span><span class="token number">412290</span><span class="token punctuation">,</span><span class="token number">412290</span><span class="token punctuation">,</span><span class="token number">218895</span><span class="token punctuation">,</span><span class="token number">218895</span><span class="token punctuation">,</span><span class="token number">218895</span><span class="token punctuation">,</span><span class="token number">218895</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;Will LLC&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Will LLC&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Will LLC&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Jerde-Hilpert&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Jerde-Hilpert&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Jerde-Hilpert&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Jerde-Hilpert&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Jerde-Hilpert&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Kulas Inc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Kulas Inc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Kulas Inc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Kulas Inc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;order_id&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token number">10006</span><span class="token punctuation">,</span><span class="token number">10006</span><span class="token punctuation">,</span><span class="token number">10006</span><span class="token punctuation">,</span><span class="token number">10006</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sku&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;B1-20000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-27722&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;B1-86481&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-06532&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-82801&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-06532&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-47412&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-27722&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;S1-27722&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;B1-33087&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;B1-33364&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;B1-20000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;quantity&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;unit_price&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">33.69</span><span class="token punctuation">,</span><span class="token number">21.12</span><span class="token punctuation">,</span><span class="token number">35.99</span><span class="token punctuation">,</span><span class="token number">55.82</span><span class="token punctuation">,</span><span class="token number">13.62</span><span class="token punctuation">,</span><span class="token number">92.55</span><span class="token punctuation">,</span><span class="token number">78.91</span><span class="token punctuation">,</span><span class="token number">25.42</span><span class="token punctuation">,</span><span class="token number">95.66</span><span class="token punctuation">,</span><span class="token number">22.55</span><span class="token punctuation">,</span><span class="token number">72.30</span><span class="token punctuation">,</span><span class="token number">72.18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ext_price&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">235.83</span><span class="token punctuation">,</span><span class="token number">232.32</span><span class="token punctuation">,</span><span class="token number">107.97</span><span class="token punctuation">,</span><span class="token number">2679.36</span><span class="token punctuation">,</span><span class="token number">286.02</span><span class="token punctuation">,</span><span class="token number">832.95</span><span class="token punctuation">,</span><span class="token number">3472.04</span><span class="token punctuation">,</span><span class="token number">915.12</span><span class="token punctuation">,</span><span class="token number">3061.12</span><span class="token punctuation">,</span><span class="token number">518.65</span><span class="token punctuation">,</span><span class="token number">216.90</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">72.18</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="聚合" tabindex="-1"><a class="header-anchor" href="#聚合" aria-hidden="true">#</a> 聚合</h2><p>求每个order的总价</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&#39;order_id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;ext_price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
order_id
10001     576.12
10005    8185.49
10006    3724.49
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="2.png">聚合</a></p><h2 id="dataframegroupby与seriesgroupby对象" tabindex="-1"><a class="header-anchor" href="#dataframegroupby与seriesgroupby对象" aria-hidden="true">#</a> DataFrameGroupBy与SeriesGroupBy对象</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;pandas.core.groupby.generic.DataFrameGroupBy 对象，注意是DataFrameGroupBy</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token comment">## 1. 因为account不能sum，所以结果自动忽略</span>
<span class="token comment">## 2. goupby的column的value，作为index</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
       ext_price
order_id           
10001     576.12
10005    8185.49
10006    3724.49
&quot;&quot;&quot;</span>
<span class="token comment">## 3. 可以从DataFrameGroupBy对象中按列名取出SeriesGroupBy</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;ext_price&quot;</span><span class="token punctuation">]</span>  <span class="token comment">#　pandas.core.groupby.generic.SeriesGroupBy 对象，注意是SeriesGroupBy</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;ext_price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 分组列自动作为索引</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
order_id
10001     576.12
10005    8185.49
10006    3724.49
&quot;&quot;&quot;</span>
<span class="token comment">## 4. 不将分组列作为索引</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> as_index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 不将分组列作为索引</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
  gender  score
0    boy  143.0
1   girl  114.0
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定制聚合结果" tabindex="-1"><a class="header-anchor" href="#定制聚合结果" aria-hidden="true">#</a> 定制聚合结果</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span>std<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 同时计算多个聚合</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 自定义聚合函数</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;ext_price&#39;</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span>
			         		<span class="token string">&#39;account&#39;</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 对不同该类进行聚合,\`ext_price&#39;列求和，&#39;account\`列计算个数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="过滤-having" tabindex="-1"><a class="header-anchor" href="#过滤-having" aria-hidden="true">#</a> 过滤(having)</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&#39;order_id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 分组后个数大于2的组，只有girl</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参考: https://pbpython.com/pandas_transform.html https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#aggregation</p>`,17);function k(m,b){const a=p("font");return o(),e("div",null,[d,u(a,{style:{background:"lightgreen"}},{default:c(()=>[s("pandas的groupby函数类似于sql的group by")]),_:1}),r])}const q=t(l,[["render",k],["__file","groupby.html.vue"]]);export{q as default};
