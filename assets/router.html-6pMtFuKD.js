import{_ as e}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as s,c as n,e as a}from"./app-MTzDpLgJ.js";const d="/assets/0-Cv7cBhKZ.png",o="/assets/1-JUSF74ZC.png",c="/assets/2-1oZIkmja.png",t="/assets/3-xBhImobk.png",i="/assets/3-1-d09bYszf.png",r="/assets/4-Nv6LY-GY.png",l="/assets/5-bA3leaSN.png",p="/assets/6-UFQcP6gL.png",m="/assets/7--BrtweAo.png",u="/assets/8-74I1dT5H.png",v="/assets/9-CJJs8XaW.png",h="/assets/10-x8d48jcI.png",b="/assets/11-pQHixe8W.png",g="/assets/12-6tPESDom.png",A="/assets/13-dTS_J_DE.png",P={},C=a(`<h1 id="router" tabindex="-1"><a class="header-anchor" href="#router" aria-hidden="true">#</a> router</h1><p>一台router有两个NIC(Network Interface Card), 可以分别处于两个的subnet中, 而两个NIC是直连的, 这样两个subnet可以通过这台router来交换信息. 一个NIC对应一个IP和一个MAC.</p><h2 id="一个router两个switch" tabindex="-1"><a class="header-anchor" href="#一个router两个switch" aria-hidden="true">#</a> 一个router两个switch</h2><h3 id="配置网络" tabindex="-1"><a class="header-anchor" href="#配置网络" aria-hidden="true">#</a> 配置网络</h3><p>配置如下网络: PC12: Gateway: 192.168.1.1 IP: 192.168.1.2 Subnet Mask: 255.255.255.0 MAC Address: 00D0.D3D6.CA86</p><p>PC13: Gateway: 192.168.1.1 IP: 192.168.1.3 Subnet Mask: 255.255.255.0 MAC Address: 0003.E493.46B6</p><p>Router1: Ethernet0/0: IP Address: 192.168.1.1 Subnet Mask: 255.255.255.0 MAC Address: 0050.0F2E.BE01</p><pre><code>Ethernet0/1:
    IP Address: 192.168.2.1
    Subnet Mask: 255.255.255.0
    MAC Address: 0050.0F2E.BE02
</code></pre><p>PC22: Gateway: 192.168.2.1 IP: 192.168.2.2 Subnet Mask: 255.255.255.0 MAC Address: 00E0.F747.6770</p><p>PC23: Gateway: 192.168.2.1 IP: 192.168.2.3 Subnet Mask: 255.255.255.0 MAC Address: 000C.CF1E.B569</p><figure><img src="`+d+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="路由器的通信流程" tabindex="-1"><a class="header-anchor" href="#路由器的通信流程" aria-hidden="true">#</a> 路由器的通信流程</h3><h3 id="路由初始化" tabindex="-1"><a class="header-anchor" href="#路由初始化" aria-hidden="true">#</a> 路由初始化</h3><p>在<code>Router1</code>上查看<code>show ip route</code>, 可以看到路由两端的网段已经链接起来了:</p><ol><li>所有从<code>192.168.1.0/24</code>网段发送给网卡<code>FastEthernet0/0 192.168.1.1</code>的非<code>192.168.1.0/24</code>网段的消息都会复制给网卡<code>FastEthernet0/1 192.168.2.1</code></li><li>所有从<code>192.168.2.0/24</code>网段发送给网卡<code>FastEthernet0/1 192.168.2.1</code>的非<code>192.168.2.0/24</code>网段得消息都会复制给网卡<code>FastEthernet0/0 192.168.1.1</code></li></ol><p>另外通过<code>show ip arp</code>命令, 可以看到<code>Router1</code>内部已经建立了<code>ARP</code>表, 它的两个网卡是可以相互通信的.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show <span class="token function">ip</span> route
<span class="token comment">## Codes: C - connected, S - static, I - IGRP, R - RIP, M - mobile, B - BGP</span>
<span class="token comment">##        D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area</span>
<span class="token comment">##        N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2</span>
<span class="token comment">##        E1 - OSPF external type 1, E2 - OSPF external type 2, E - EGP</span>
<span class="token comment">##        i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area</span>
<span class="token comment">##        * - candidate default, U - per-user static route, o - ODR</span>
<span class="token comment">##        P - periodic downloaded static route</span>
<span class="token comment">## </span>
<span class="token comment">## Gateway of last resort is not set</span>
<span class="token comment">## </span>
<span class="token comment">## C    192.168.1.0/24 is directly connected, FastEthernet0/0</span>
<span class="token comment">## C    192.168.2.0/24 is directly connected, FastEthernet0/1</span>
show <span class="token function">ip</span> arp
<span class="token comment">## Protocol  Address          Age (min)  Hardware Addr   Type   Interface</span>
<span class="token comment">## Internet  192.168.1.1             -   0050.0F2E.BE01  ARPA   FastEthernet0/0</span>
<span class="token comment">## Internet  192.168.2.1             -   0050.0F2E.BE02  ARPA   FastEthernet0/1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="模拟通信过程" tabindex="-1"><a class="header-anchor" href="#模拟通信过程" aria-hidden="true">#</a> 模拟通信过程</h4><ol><li>在<code>PC12</code>上执行<code>ping 192.168.2.2</code>命令, 因为subnet不同, 所以ARP包会发给<code>PC12</code>配置的网关<code>192.168.1.1</code>.</li></ol><figure><img src="`+o+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="2"><li><code>switch1</code>拿到ARP包,首先记下<code>PC12</code>的MAC地址, 然后判断<code>DEST MAC</code>是<code>F...F</code>, 所以会发给该subnet下, 所有NIC.</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show mac address-table 
<span class="token comment">##           Mac Address Table</span>
<span class="token comment">## -------------------------------------------</span>
<span class="token comment">## </span>
<span class="token comment">## Vlan    Mac Address       Type        Ports</span>
<span class="token comment">## ----    -----------       --------    -----</span>
<span class="token comment">## </span>
<span class="token comment">##    1    00d0.d3d6.ca86    DYNAMIC     Fa0/1</span>
<span class="token comment">## \`\`\`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+c+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="3"><li><code>Router1</code>拿到ARP包后, 首先记录<code>PC12</code>的ARP信息, 然后反向发送给<code>switch1</code>, 告诉其<code>Router1 0/0</code>的MAC</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show <span class="token function">ip</span> arp
<span class="token comment">## Protocol  Address          Age (min)  Hardware Addr   Type   Interface</span>
<span class="token comment">## Internet  192.168.1.1             -   0050.0F2E.BE01  ARPA   FastEthernet0/0</span>
<span class="token comment">## Internet  192.168.1.2             0   00D0.D3D6.CA86  ARPA   FastEthernet0/0</span>
<span class="token comment">## Internet  192.168.2.1             -   0050.0F2E.BE02  ARPA   FastEthernet0/1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+t+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="4"><li><code>Switch1</code>拿到ARP包后, 首先记录<code>Router1 0/0</code>显卡的MAC信息, 然后发送给<code>PC12</code></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show mac address-table 
<span class="token comment">##           Mac Address Table</span>
<span class="token comment">## -------------------------------------------</span>
<span class="token comment">## </span>
<span class="token comment">## Vlan    Mac Address       Type        Ports</span>
<span class="token comment">## ----    -----------       --------    -----</span>
<span class="token comment">## </span>
<span class="token comment">##    1    0050.0f2e.be01    DYNAMIC     Fa0/3</span>
<span class="token comment">##    1    00d0.d3d6.ca86    DYNAMIC     Fa0/1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="5"><li><code>PC1</code>拿到ARP包后,首先记录<code>Router1</code>的地址, 然后 将<code>Router1</code> MAC地址补充完成, 开始发送<code>ICMP</code>包, 到<code>Router1</code></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>arp <span class="token parameter variable">-a</span>
<span class="token comment">## Internet Address      Physical Address      Type</span>
<span class="token comment">## 192.168.1.1           0050.0f2e.be01        dynamic</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="6"><li><p><code>Router1</code>拿到<code>ICMP</code>包后, 发现目的IP是<code>192.168.2.2</code>, 而目前<code>0/1</code>网卡并不知道其MAC地址, 所以将ICMP包丢弃, 然后<code>0/1</code>创建ARP包, 开始查询<code>192.168.2.2</code>的MAC地址. 过程和在<code>192.168.1.0</code>网段相同. <img src="'+l+'" alt="" loading="lazy"><img src="'+p+`" alt="" loading="lazy"></p></li><li><p>当ARP包返回到<code>Router1</code>之后, <code>Router1</code>记录<code>PC22</code>的MAC地址</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show <span class="token function">ip</span> arp
<span class="token comment">## Protocol  Address          Age (min)  Hardware Addr   Type   Interface</span>
<span class="token comment">## Internet  192.168.1.1             -   0050.0F2E.BE01  ARPA   FastEthernet0/0</span>
<span class="token comment">## Internet  192.168.1.2             0   00D0.D3D6.CA86  ARPA   FastEthernet0/0</span>
<span class="token comment">## Internet  192.168.2.1             -   0050.0F2E.BE02  ARPA   FastEthernet0/1</span>
<span class="token comment">## Internet  192.168.2.2             0   00E0.F747.6770  ARPA   FastEthernet0/1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到, 此时两个网段的MAC地址链路已经建立: 192.168.1.2(00D0.D3D6.CA86) 可以查到 192.168.1.1(0050.0F2E.BE01) 192.168.1.1(0050.0F2E.BE01) 可以查到192.168.2.1(0050.0F2E.BE02) 192.168.2.1(0050.0F2E.BE02) 可以查到192.168.2.2(00E0.F747.6770)</p><figure><img src="`+m+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="8"><li><p><code>PC12</code>开始发送ICMP包, 首先是根据MAC地址发送给<code>Router1</code> <code>0/0</code>网卡 <img src="'+u+'" alt="" loading="lazy"></p></li><li><p><code>Router 1 0/0</code>(192.168.1.1)将数据发送给<code>Router1 0/1</code>(192.168.2.1)网卡 <img src="'+v+'" alt="" loading="lazy"></p></li><li><p><code>PC22</code>收到ICMP包, 并返回 <img src="'+h+'" alt="" loading="lazy"><img src="'+b+'" alt="" loading="lazy"><img src="'+g+`" alt="" loading="lazy"></p></li></ol><h2 id="两台router三台switch" tabindex="-1"><a class="header-anchor" href="#两台router三台switch" aria-hidden="true">#</a> 两台Router三台Switch</h2><h3 id="配置网络-1" tabindex="-1"><a class="header-anchor" href="#配置网络-1" aria-hidden="true">#</a> 配置网络</h3><p>配置如下网络: PC12: Gateway: 192.168.1.1 IP: 192.168.1.2 Subnet Mask: 255.255.255.0 MAC Address: 00D0.D3D6.CA86</p><p>PC13: Gateway: 192.168.1.1 IP: 192.168.1.3 Subnet Mask: 255.255.255.0 MAC Address: 0003.E493.46B6</p><p>Router1: Ethernet0/0: IP Address: 192.168.1.1 Subnet Mask: 255.255.255.0 MAC Address: 0050.0F2E.BE01</p><pre><code>Ethernet0/1:
    IP Address: 192.168.2.1
    Subnet Mask: 255.255.255.0
    MAC Address: 0050.0F2E.BE02
</code></pre><p>Router1: Ethernet0/0: IP Address: 192.168.1.1 Subnet Mask: 255.255.255.0 MAC Address: 0050.0F2E.BE01</p><pre><code>Ethernet0/1:
    IP Address: 192.168.3.1
    Subnet Mask: 255.255.255.0
    MAC Address: 0050.0F2E.BE02
</code></pre><p>Router2: Ethernet0/0: IP Address: 192.168.3.2 Subnet Mask: 255.255.255.0 MAC Address: 0001.43D2.2B01</p><pre><code>Ethernet0/1:
    IP Address: 192.168.2.1
    Subnet Mask: 255.255.255.0
    MAC Address: 0001.43D2.2B02
</code></pre><p>PC22: Gateway: 192.168.2.1 IP: 192.168.2.2 Subnet Mask: 255.255.255.0 MAC Address: 00E0.F747.6770</p><p>PC23: Gateway: 192.168.2.1 IP: 192.168.2.3 Subnet Mask: 255.255.255.0 MAC Address: 000C.CF1E.B569</p><figure><img src="`+A+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="一台router与两台router的区别" tabindex="-1"><a class="header-anchor" href="#一台router与两台router的区别" aria-hidden="true">#</a> 一台Router与两台Router的区别</h3><p>一个路由器连接两个子网, 路由器的两个网卡会自动传递信息 两个路由器连接三个子网, 则需要配置路由规则.</p><p>首先在<code>Router1</code>中配置, 将所有<code>192.168.1.0</code>网段中请求<code>192.168.2.0</code>的包都转发给<code>192.168.3.0</code>网段中的<code>Router2</code>的<code>0/0</code>网卡<code>192.168.3.2</code>.具体的: 假设<code>PC12</code>ping<code>PC22</code>, 此时<code>PC12</code>发送了<code>ICMP</code>包, 根据路由<code>192.168.1.1</code>到<code>Router1</code>的<code>0/0</code>网卡, <code>0/0</code>网卡, 将此<code>ICMP</code>包发送给<code>0/1</code>网卡<code>192.168.3.1</code>, 根据子网掩码, 发现此包的目的地并不在<code>192.168.3.0</code>网段中, 所以会丢弃. 这时就需要我们告诉<code>Router1</code>, 将所有请求<code>192.168.2.0</code>网段的包, 都发给<code>Router2</code>的<code>0/0</code>网卡<code>192.168.3.2</code>, 让其继续寻找. <code>Router2</code>的<code>0/0</code>网卡<code>192.168.3.2</code>将<code>ICMP</code>包复制给<code>0/1</code>网卡<code>192.168.2.1</code>, 这样就可以找到<code>192.168.2.2</code>了.</p><p>配置方法如下: 在<code>Router1</code>中输入: <code>ip route 192.168.2.0 255.255.255.0 192.168.3.2</code> 第一个参数: <code>192.168.2.0</code>表示要请求的那个网段进行转发 第二个参数: <code>255.255.255.0</code>是子网掩码, 和第一个参数与运算, 确定网段,所以第一个参数也可以是一个具体ip, 比如<code>192.168.2.2</code> 第三个参数: <code>192.168.3.2</code>是要转发的目的地</p><p>注意这里我们只配置<code>Router1</code>, 此时只能从<code>PC12</code>访问<code>PC22</code>, 而不能从<code>PC22</code>访问<code>PC12</code>. 所以我们要继续配置<code>Router2</code>. 在<code>Router2</code>中输入: <code>ip route 192.168.1.0 255.255.255.0 192.168.3.1</code></p>',55),E=[C];function k(I,f){return s(),n("div",null,E)}const F=e(P,[["render",k],["__file","router.html.vue"]]);export{F as default};
