# 数据库技术基础

## 数据库系统

- 数据：是数据库中存储的基本对象，是描述事物的符号记录。数据的种类：文本、图形、图像、音频、视频。
- 数据库DB:是长期存储在计算机内、有组织的、可共享的大量数据的集合。
- 数据库的基本特征：
    - 数据按一定的数据模型组织、描述和存储；
    - 可为各种用户共享；
    - 冗余度较小；
    - 数据独立性较高；
    - 易扩展。


- 数据库系统DBS:是一个采用了数据库技术，有组织地、动态地存储大量相关数据，方便多用户访问的计算机系统。其由下面四个部分组成：
    - 数据库(统一管理、长期存储在计算机内的，有组织的相关数据的集合)
    - 硬件（构成计算机系统包括存储数据所需的外部设备）
    - 软件(操作系统、数据库管理系统及应用程序)
    - 人员(系统分析和数据库设计人员、应用程序员、最终用户、数据库管理员DBA)
- 数据库管理系统DBMS的功能: 实现对共享数据有效的组织、管理和存取。包括数据定义、数据库操作、数据库运行管理、数据的存储管理、数据库的建立和维护等。




三种模式:
- 内模式：管理如何存储物理的数据，对应具体物理存储文件。
- 模式：又称为概念模式，就是我们通常使用的基本表，根据应用、需求将物理数据划分成一张张表。(完整的一张表)
- 外模式：对应数据库中的视图这个级别，将表进行一定的处理后再提供给用户使用.(一张表的部分查询的数据)


两种映射: 
- 外模式一模式映像：是表和视图之间的映射，存在于概念级和外部级之间，若表中数据发生了修改，只需要修改此映射，而无需修改应用程序。
- 模式一内模式映像：是表和数据的物理存储之间的映射，存在于概念级和内部级之间，若修改了数据存储方式，只需要修改此映射，而不需要去修改应用程序。

[](./5数据库技术基础/1.png)



## 数据库设计 ❤️

1. 需求分析：即分析数据存储的要求，产出物有数据流图, 数据字典, 需求说明书。
2. 概念结构设计：就是设计E-R图，也即实体-属性图，与物理实现无关，说明有哪些实体，实体有哪些属性。
3. 逻辑结构设计：将E-R图，转换成关系模式，也即转换成实际的表和表中的列属性，这里要考虑很多规范化的东西。
4. 物理设计：根据生成的表等概念，生成物理数据库。


在数据库系统中，数据库的视图、基本表和存储文件的结构分别与（）对应：数据的物理独立性和数据的逻辑独立性是分别通过修改（）来完成的。  
A模式、外模式、内模式  
B模式、内模式、外模式  
C外模式、模式、内模式  
D.外模式、内模式、模式

A模式与内模式之间的映像、外模式与模式之间的映像  
B外模式与内模式之间的映像、外模式与模式之间的映像  
C外模式与模式之间的映像、模式与内模式之间的映像  
D.外模式与内模式之间的映像、模式与内模式之间的映像  

答案：CA

在数据库逻辑结构设计阶段，需要（）阶段形成的（）作为设计依据。  
A.需求分析  
B.概念结构设计  
C.物理结构设计  
D,数据库运行和维护  

A.程序文档、数据字典和数据流图。  
B.需求说明文档、程序文档和数据流图  
C.需求说明文档、数据字典和数据流图  
D.需求说明文档、数据字典和程序文档

答案：AC

## 数据模型

- 关系模型是二维表的形式表示的实体-联系模型，是将实体-联系模型转换而来的，经过开发人员设计的；
- 概念模型是从用户的角度进行建模的，是现实世界到信息世界的第一抽象，是真正的实体-联系模型。
- 网状模型表示实体类型及其实体之间的联系，一个事物和另外几个都有联系，形成一张网。
- 面向对象模型是采用面向对象的方法设计数据库，以对象为单位，每个对象包括属性和方法，具有类和继承等特点。
- 数据模型三要亲：`数据结构`（所研究的对象类型的集合）、`数据操作`（对数据库中各种对象的实例允许执行的操作的集合）、`数据的约束条件`（一组完整性规则的集合）。




- 用E-R图来描述概念数据模型，世界是由一组称作实体的基本对象和这些对象之间的联系构成的。
- 在E-R模型中，使用椭圆表示属性（一般没有）、长方形表示实体(长方形加两条杠是弱实体)、菱形表示联系，联系的两端要填写联系类型(一对一,一对多, 多对多)，示例如下图：


[](./5数据库技术基础/2.png)


- 实体：客观存在并可相互区别的事物。可以是具体的人、事、物或抽象概念。如人、汽车、图书、账户、贷款。
- 弱实体和强实体：弱实体依赖于强实体的存在而存在。强实体和弱实体的关系使用小圆圈表示, 比如经理是弱实体, 员工是强实体, 表示经理也是员工的一种.
- 实体集：具有相同类型和共享相同属性的实体的集合，如学生、课程。
- 属性：实体所具有的特性。
- 属性分类：简单属性和复合属性；单值属性和多值属性；NULL属性；派生属性(通过身份证找出生日)。
- 域：属性的取值范围称为该属性的域。
- 码(key):唯一标识实体的属性集。
- 联系：现实世界中事物内部以及事物之间的联系，在E-图中反映为实体内部的联系和实体之间的联系。
- 联系类型：一对一1:1、一对多1:N、多对多M:N。

- 两个以上实体型关系:

    ![](./5数据库技术基础/3.png)

    教师使用参考书教授课程
    一个课程多个教师教授, 一个课程可以由多种参考书


- 关系模型中数据的逻辑结构是一张二维表）由行列组成。用表格结构表达实体集，用外键标识实体间的联系。如下图：

    ![](./5数据库技术基础/4.png)


    优点：建立在严格的数学概念基础上：概念单一、结构简单、清晰，用户易懂易用；存取路径对用户透明，从而数据独立性、安全性好，简化数据库开发工作。  
    缺点：由于存取路径透明，查询效率往往不如非关系数据模型。



- E-模型转换为关系模型：`每个实体都对应一个关系模式`, 联系分为三种：

    - 1:1联系中，联系可以放到任意的两端实体中，作为一个属性（要保证1:1的两端关联），也可以转换为一个单独的关系模式：
    - 1:N的联系中，联系可以单独作为一个关系模式，也可以在N端中加入1端实体的主键；
    - M:N的联系中，联系必须作为一个单独的关系模式，其主键是M和N端的联合主键。


题目:

某本科高校新建教务管理系统，支撑各学院正常的教学教务管理工作。经过初步分析，系统中包含的实体有学院、教师、学生、课程等。考虑需要将本科学生的考试成绩及时通报给学生家长，新增家长实体；考虑到夜大、网络教育学生管理方式的不同，需要额外的管理数据，新增进修学生实体：规定一个学生可以选择多门课程，每门课程可以被多名学生选修；一个教师可以教授多门课程，一门课程只能被一名教师讲授。（）实体之间为多对多联系，（）属于弱实体对强实体的依赖联系。

A、学生、学院  
B、教师、学院  
C、学生、课程  
D、教师、课程

A、家长、学生  
B、学生、教师  
C、学生、学院  
D、教师、学院

答案：CA  
解析：一个学生可以选择多门课程，每门课程可以被多名学生选修，因此学生和课程是多对多。
弱实体依赖于强实体的存在而存在，只有学生存在，其家长信息才会存在，否则单独的家长信息无意义。


54-56.部门、员工和项目的关系模式及它们之间的E-图如下所示，其中关系模式中带实下划线的属性表示主键属性。图中：  
- 部门(部门代码，部门名称，电话)
- 员工(员工代码，姓名，部门代码，联系方式，薪资)
- 项目(项目编号，项目名称，承担任务)

[](./5数据库技术基础/5.png)

若部门和员工关系进行自然连接运算，其结果为(54)元关系。由于员工和项目之间的联系类型为(55)，所以员工和项目之间的联系需要转换成一个独立的关系模式，该关系模式的主键是(56).

(54)  
A.5  
B.6  
C.7  
D.8

(55)  
A.1对1  
B.1对多  
C.多对1  
D.多对多

(56)  
A.(项目名称，员工代码)  
B.(项目编号，员工代码)  
C.(项目名称，部门代码)  
D.(项目名称，承担任务)  

答案：CDB





## 关系代数
- 并：结果是两张表中所有记录数合并，相同记录只显示一次。
- 交：结果是两张表中相同的记录。
- 差：$S1-S2$,结果是51表中有而S2表中没有的那些记录。


    ![](./5数据库技术基础/6.png)


- 笛卡尔积：$S1 \times S2$,产生的结果包括S1和S2的所有属性列，并且S1中每条记录依次和S2中所有记录组合成一条记录，最终属性列为S1+S2属性列，记录数为$S1 \times S2$记录数。
- 投影：实际是按条件选择某关系模式中的某列，列也可以用数字表示。$\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列
- 选择：实际是按条件选择某关系模式中的某条记录。$\sigma_{3=5 \land 4 = 6}$: 是选择操作, 选择第3列和第5列值相等且第4列和第6列值相等的行


    ![](./5数据库技术基础/7.png)


- 自然连接的结果显示全部的属性列，但是相同属性列只显示一次，显示两个关系模式中属性相同且值相同的记录。设有关系R、S如下左图所示，自然连接结果如下右图所示：

    ![](./5数据库技术基础/8.png)


给定关系$R(A, B, C, D)$和关系$S(C, D, E)$, 对其进行自然连接运算$R \bowtie S$后的属性列为()个;  
与$\sigma_{R.B>S.E}(R \bowtie S)$等价的关系代数表达式为().

A.$\sigma_{2>7}(R \times S)$  
B.$\pi_{1,2,3,4,7}(\sigma_{'2'>'7' \land 3=5 \land 4=6}(R \times S))$  
C.$\sigma_{'2'>'7'}(R \times S)$  
D.$\pi_{1,2,3,4,7}(\sigma_{2>7 \land 3=5 \land 4=6}(R \times S))$  

答案: D

- $R(A, B, C, D)$: $R$是表的名字, $ABCD$是列名.
- $R \bowtie S$: 是自然连接运算, 结果是$S \bowtie R = (ABCDE)$
- $R \times S$: 是笛卡尔积连接运算, 结果是$S \times R = (ABCDCDE)$
- $\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列
- $\sigma_{3=5 \land 4 = 6}$: 是选择操作, 选择第3列和第5列值相等且第4列和第6列值相等的行
- $\land$: 是逻辑且

$\pi_{1,2,3,4,7}(\sigma_{2>7 \land 3=5 \land 4=6}(R \times S))$的意思是:
1. 对$R和S$进行笛卡尔积计算, 列的结果是: $S \times R = (ABCDCDE)$, 对应列的编号是$(1234567)$
2. 对上一步结果进行选择操作: $\sigma_{2>7 \land 3=5 \land 4=6}$, 即取第2列大于第7列且第3列等于第5列且第4列等于第6列的行
    1. CD列相同的行, $\sigma_{3=5 \land 4 = 6}$. 序号是笛卡尔连接结果对应的下标$(ABCDCDE)(1234567)$
    2. 题目中自然连接$\sigma_{R.B>S.E}$的条件,对应笛卡尔积的为 $\sigma_{2>7}$
    3. 将上面两个条件合并$\sigma_{2>7 \land 3=5 \land 4 = 6}$
3. 对上一步记过进行投影操作: $\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列

上面的笛卡尔积变换公式和自然连接公式等价: $\sigma_{R.B>S.E}(R \bowtie S)$



## 函数依赖
- 给定一个X,能唯一确定一个Y,就称x确定Y,或者说Y依赖于X,例如Y=X*X函数。

函数依赖又可扩展以下两种规则：
- 部分函数依赖：A可确定C,(A,B)也可确定C,(A,B)中的一部分(即A)可以确定C,称为部分函数依赖。
- 传递函数依赖：当A和B不等价时，A可确定B,B可确定C,则A可确定C,是传递函数依赖；若A和B等价，则不存在传递，直接就可确定C。


[](./5数据库技术基础/9.png)


- 函数依赖的公理系统(Armstrong)

    设关系模式$R<U,F>$,$U$是关系模式$R$的属性全集，$F$是关系模式$R$的一个函数依赖集。对于$R<U,F>$来说有以下的：

    - 自反律：若$Y \subseteq X \subseteq U$,则X→Y为F所逻辑蕴含
    - 增广律：若X→Y为F所逻辑蕴含，且ZCU,则X2→YZ为F所逻辑蕴含
    - 传递律：若X→Y和Y→Z为F所逻辑蕴含，则x→Z为F所逻辑蕴含
    - 合并规则：若X→Y,X→Z,则X→YZ为F所蕴涵
    - 伪传递率：若X→Y,WN→Z,则XW→Z为F所蕴涵
    - 分解规则：若x→Y,$Z \subseteq Y$,则X→Z为所蕴涵


## 键与约束

- 超键：能唯一标识此表的属性的组合。
- 侯选键：超键中去掉冗余的属性，剩余的属性就是侯选键。(比如学号, 身份证号都可以唯一标识)
- 主键：任选一个侯选键，即可作为主键
- 外键：其他表中的主键
- 主属性：候选键内的属性为主属性，其他属性为非主属性。

约束

- 实体完整性约束：即主键约束，主键值不能为空，也不能重复。
- 参照完整性约束：即外键约束，外键必须是其他表中已经存在的主键的值，或者为空
- 用户自定义完整性约束：自定义表达式约束，如设定年龄属性的值必须在0到150之间。



## 范式

- 第一范式1NF
    关系中的每一个分量必须是一个不可分的数据项。通俗地说，第一范式就是表中不允许有小表的存在。比如，对于如下的员工表，就不属于第一范式：


    [](./5数据库技术基础/10.png)

    - 实例：用一个单一的关系模式学生来描述学校的教务系统：学生（学号，学生姓名，系号，系主任姓名，课程号，成绩）
    - 依赖关系（学号->学生姓名，学号>系号，系号>系主任姓名，学号>课程号，(学号，课程号)>成绩）


    [](./5数据库技术基础/11.png)

    学号有重复, 不能唯一标识. 使用(学号,课程号)做联合主键.

- 第二范式

    如果关系R属于1NF,且每一个非主属性完全函数依赖于任何一个候选码，则R属于2NF.
    通俗地说，2NF就是在1NF的基础上，表中的每一个非主属性不会依赖复合主键中的某一个列。只存在多个属性的主键中.
    按照定义，上面的学生表就不满足2NF，因为学号不能完全确定课程号和成绩（每个学生可以选多门课）。
    将学生表分解为：
    - 学生(学号，学生姓名，系编号，系名，系主任)
    - 选课(学号，课程号，成绩)。
    每张表均属于2NF。

- 第三范式
    在满足1NF的基础上，表中不存在非主属性对码的传递依赖。

    继续上面的实例，学生关系模式就不属于3NF,因为学生无法直接决定系主任和系名，是由学号->系编号，再由系编号>系主任，系编号->系名，因此存在非主属性对主属性的传递依赖，

    将学生表进一步分解为：
    - 学生(学号，学生姓名，系编号)
    - 系(系编号，系名，系主任)
    - 选课(学号，课程号，成绩)

    每张表都属于3NF。




- BC范式BCNF，是指在第三范式的基础上进一步消除主属性对于码的部分函数依赖和传递依赖。
- 通俗的来说，就是在每一种情况下，每一个依赖的左边决定因素都必然包含候选键，如下：

[](./5数据库技术基础/12.png)

- 上图中，候选键有两种情况：组合键(S,T)或者(S,J),依赖集为{SJ一T,T一J}可知，STJ三个属性都是主属性，因此其达到了3NF（无非主属性），然而，第二种情况，即(S,J)为候选键的时候，对于依赖T->J,T在这种情况不是候选键，即T-J的决定因素不包含任意候选码，因此上图不是BCNF.
- 要使上图关系模式转换为BCNF也很简单，只需要将依赖T->J变为TS->J即可，这样其左边决定因素就包含了候选键之一S。



给定关系模式R(U,F),U={A,B,C,D},F={AB→C,CD→B}。关系R（）,且分别有（）。  
A.只有1个候选关键字ACB  
B.只有1个候选关键字BCD  
C.有2个候选关键字ACD和ABD  
D.有2个候选关键字ACB和BCD


A.0个非主属性和4个主属性  
B.1个非主属性和3个主属性  
C.2个非主属性和2个主属性  
D.3个非主属性和1个主属性

候选关键字的求法：根据依赖集，找出`从未在右边出现过的属性，必然是候选键之一`，以该属竹为基础，根据依赖集依次扩展，`看能否遍历所有属性`，将无法遍历的加入候选键中。
答案：CA



设有关系模式R(E,N,M,L,Q),其函数依赖集为F={E→N,EM→Q,M→L}。则关系模式R达到了()；该关系模式();

A.1NF  
B.2NF  
C.3NF  
D.BCNF  

A.无需进行分解，因为已经达到了3NF  
B.无需进行分解，因为已经达到了BCNF  
C.尽管不存在部分函数依赖，但还存在传递依赖，所以需要进行分解  
D.需要进行分解，因为存在冗余、修改操作的不一致性、插入和删除异常  





## 模式分解

范式之间的转换一般都是通过拆分属性，即模式分解，将具有部分函数依赖和传递依赖的属性分离出来，来达到一步步优化，一般分为以下两种：

- 保持函数依赖分解

    对于关系模式R，有依赖集F,若对R进行分解，分解出来的多个关系模式，保持原来的依赖集不变，则为保持函数依赖的分解。另外，注意要消除掉冗余依赖（如传递依赖）。如设原关系模式R(A,B,C),依赖集F(A->B,B->C,A->C),将其分解为两个关系模式R1(A,B)和R2(B,C),此时R1中保持依赖A->B,R2保持依赖B->C,说明分解后的R1和R2是保持函数依赖的分解，因为A->C这个函数依赖实际是一个冗余依赖，可以由前两个依赖传递得到，因此不需要管。

    保持函数依赖的判断（补充，第2点不强求）：

    1. 如果F上的每一个函数依赖都在其分解后的某一个关系上成立，则这个分解是保持依赖的（这是一个充分条件）。也即我们课堂上说的简单方法，看函数每个依赖的左右两边属性是否都在同一个分解的模式中。
    2. 如果上述判断失败，并不能断言分解不是保持依赖的，还要使用下面的通用方法来做进一步判断。该方法的表述如下：
    
        对F上的每一个 $\alpha$ → $\beta$ 使用下面的过程：🔴不考直接用1来判断
        result:=a;  
        while(result发生变化)do  
        for each分解后的Ri  
        t=(resultnRi)+ $\cap$ Ri  
        result=result $\cup$ t  


        假设关系模式R(U,F),属性集U={A,B,C},函数依赖集F={A→B,B→C}。若将其分解为p={R1(U1,F1),R2(U2,F2)}, 其中U1={A,B}, U2={A,C}。那么，分解p（）  
        A,有损连接但保持函数依赖  
        B.既无损连接又保持函数依赖  
        C.有损连接且不保持函数依赖  
        D.无损连接但不保持函数依赖  

        答案：D

        解析：首先，该分解，U1保持了依赖A->B,然而B->C没有保持，因此针对B->C需要用第2点算法来判断：    
        result=B,result $\cap$ U1=B,B+=BC,BC $\cap$ U1=B. result=B $cup$ B=B,result没变，然后，resulti再和U2交是空，结束了，不保持函数依赖。  
        注意，这里B+,+的意思是代表由B能够推导出的其他所有属性的集合，这里B>C,因此B+=BC。


- 无损分解

    - 无损分解：分解后的关系模式能够还原出原关系模式，就是无损分解，不能还原就是有损。
    - 当分解为两个关系模式，可以通过以下定理判断是否无损分解：

        定理：如果R的分解为P={R1,R2},F为R所满足的函数依赖集合，分解具有无损
        连接性的充分必要条件是R1 $\cap$ R2->(R1-R2)或者R1 $\cap$ R2->(R2-R1).

    - 当分解为三个及以上关系模式时，可以通过表格法求解，如下：


    思考题：
    - 有关系摸式：成绩(学号，姓名，课程号，课程名，分数)
    - 函数依赖：学号→姓名，课程号→课程名，(学号，课程号)→分数
    - 若将其分解为：
        - 成绩(学号，课程号，分数)
        - 学生(学号，姓名)
        - 课程(课程号，课程名)


    空|学号|姓名|课程号|课程名|分数
    --|--|--|--|--|--
    成绩|√|×|√|×|√
    学生|√|√|×|×|×
    课程|x|×|√|√|×


    请思考该分解是香为无损分解？
    - 由于有：学号一姓名，所以：成绩(学号，课程号，分数，姓名)
    - 由于有：课程号一课程名，所以：成绩(学号，课程号，分数，姓名，课程名)


    根据学号→姓名，对上表进行处理，将×改成符号√：然后考虑课程号→课程名，将×改为√，得下表：

    空|学号|姓名|课程号|课程名|分数
    --|--|--|--|--|--
    成绩|√|√|√|√|√
    学生|√|√|×|x|x
    课程|x|x|√|√|x


给定关系模式R(U,F),U={A,B,C,D,E},F={B→A,D→A,A→E,AC→B},则R的候选关键字为（），分解P={R1(ABCE),R2(CD)}, （）.
A.CD  
B.ABD  
C.ACD  
D.ADE  

A.具有无损连接性，且保持函数依赖  
B.不具有无损连接性，但保持函数依赖  
C具有无损连接性，但不保持函数依赖  
D.不具有无损连接性，也不保持函数依赖



## 并发控制

- 事务(进程)：由一系列操作组成，这些操作，要么全做，要么全不做，拥有四种特性，详解如下：
    - （操作）原子性：要么全做，要么全不做。(如增删改查, 组成一个事务, 要么全做, 要么全不做)
    - （数据）一致性：事务发生后数据是一致的，例如银行转账，不会存在A账户转出，但是B账户没收到的情况。
    - （执行）隔离性：任一事务的更新操作直到其成功提交的整个过程对其他事务都是不可见的，不同事务之间是隔离的，互不干涉。
    - （改变）持续性：事务操作的结果是持续性的。
- 事务是并发控制的前提条件，并发控制就是控制不同的事务并发执行，提高系统效率，但是并发控制中存在下面三个问题：

    - 丢失更新：事务1对数据A进行了修改并写回，事务2也对A进行了修改并写回此时事务2写回的数据会覆盖事务1写回的数据，就丢失了事务1对的更新。即对数据A的更新会被覆盖。
    - 不可重复读：事务2读A,而后事务1对数据A进行了修改并写回，此时若事务2再读A,发现数据不对。即一个事务重复读A两次，会发现数据A有误。
    - 读脏数据：事务1对数据A进行了修改后，事务2读数据A,而后事务1回滚，数据A恢复了原来的值，那么事务2对数据A做的事是无效的，读到了脏数据。


    ![](./5数据库技术基础/13.png)



## 封锁协议
- X锁是排它锁（写锁）。若事务T对数据对象A加上X锁，则只允许T读取和修改A,其他事务都`不能再对A加任何类型的锁`，直到T释放A上的锁。
- S锁是共享锁（读锁）。若事务T对数据对象A加上S锁，则只允许T读取A,但不能修改A,其他事务`只能再对A加S锁`（也即能读不能修改），直到T释放A上的S锁。
- 共分为三级封锁协议，如下：
    - 一级封锁协议：事务在修改数据R之前必须先对其加X锁，直到事务结束才释放。可解决丢失更新问题。

        ![](./5数据库技术基础/14.png)

    - 二级封锁协议：一级封锁协议的基础上加上事务T在读数据之前必须先对其加S锁，读完后即可释放s锁。可解决丢失更新、读脏数据问题。

        ![](./5数据库技术基础/15.png)


    - 三级封锁协议：一级封锁协议加上事务T在读取数据之前先对其加S锁，直到事务结束才释放。可解决丢失更新、读脏数据、数据重复读问题。

        ![](./5数据库技术基础/16.png)



“当多个事务并发执行时，任一事务的更新操作直到其成功提交的整个过程对其他事务都是不可见的”，这一性质通常被称为事务的0.

A.原子性  
B.一致性  
C.隔离性  
D.持久性

答案: C

若事务T1对数据D1加了共享锁，事务T2、T3分别对数据D2、D3加了排它锁，则事务T1对数据0;事务T2对数据0

A.D2、D3加排它锁都成功  
B.D2、D3加共享锁都成功  
C.D2加共享锁成功，D3加排它锁失败  
D.D2、D3加排它锁和共享锁都失败

A.D1、D3加共享锁都失败  
B.D1、D3加共享锁都成功  
C.D1加共享锁成功，D3如排它锁失败  
D.D1加排它锁成功，D3加共享锁失败

答案: DC




## 数据库安全


措施|说明
--|--
用户标识和鉴定|最外层的安全保护措施，可以使用用户帐户、口令及随机数检验等方式
存取控制|对用户进行授权，包括操作类型（如查找、插入、除、修改等动作）和数据对橡（主要是数据范围）的权限，
密码存储和传输|对远程终端信息用密码传输
视图的保护|对视图进行授权
审计|使用一个专用文件或数据库，自动将用户对数据库的所有操作记录下来



故障关系|故障原因|解决方法
--|--|--
事务本身的可预期故障|本身逻辑|在程序中预先设置Rollback语句
事务本身的不可预期故障|算术溢出、违反存储保护|由DBMS的恢复子系统通过日志，撤消事务对数据库的修改，回退到事务初始状态
系统故障|系统停止运转|通常使用检查点法
介质故障|外存被破坏|一般使用日志重做业务

静态&动态

- 静态转储：即冷备份，指在转储期间不允许对数据库进行任何存取、修改操作；
    - 优点是非常快速的备份方法、容易归档（直接物理复制操作）；
    - 缺点是只能提供到某一时间点上的恢复，不能做其他工作，不能按表或按用户恢复。

- 动态转储：即热备份，在转储期间允许对数据库进行存取、修改操作，因此，转储和用户事务可并发执行：
    - 优点是可在表空间或数据库文件级备份，数据库扔可使用，可达到秒级恢复；
    - 缺点是不能出错，否则后果严重，若热备份不成功，所得结果几乎全部无效。

按被分量分类:

- 完全备份：备份所有数据。
- 差量备份：仅备份上一次`完全备份`之后变化的数据。
- 增量备份：备份上一次`备份`之后变化的数据。


日志文件:

日志文件：在事务处理过程中，DBMS把事务开始、事务结束以及对数据库的插入、删除和修改的每一次操作写入日志文件。一旦发生故障，DBMS的恢复子系统利用日志文件撤销事务对数据库的改变，回退到事务的初始状态。


### 分布式数据库

- 局部数据库位于不同的物理位置，使用一个全局DBMS将所有局部数据库联网管理，这就是分布式数据库。
- 分片模式
    - 水平分片：将表中水平的记录分别存放在不同的地方。
    - 垂直分片：将表中的垂直的列值分别存放在不同的地方。
- 分布透明性
    - 分片透明性：用户或应用程序不需要知道逻辑上访问的表具体是如何分块存储的。
    - 位置透明性：应用程序不关心数据存储物理位置的改变。
    - 逻辑透明性：用户或应用程序无需知道局部使用的是哪种数据模型。
    - 复制透明性：用户或应用程序不关心复制的数据从何而来。

    > 透明是看不见的意思


### 数据仓库


数据仓库, 集合不同数据库的数据, 是一个面向主题的、集成的、非易失的、且随时间变化的数据集合，用于支持管理决策。

- 面向主题：按照一定的主题域进行组织的。
- 集成的：数据仓库中的数据是在对原有分散的数据库数据抽取、清理的基础上经过系统加工、汇总和整理得到的，必须消除源数据中的不一致性，以保证数据仓库内的信息是关于整个企业的一致的全局信息。
- 相对稳定的：数据仓库的数据主要供企业决策分析之用，所涉及的数据操作主要是数据查询，一旦某个数据进入数据仓库以后，一般情况下将被长期保留，也就是数据仓库中一般有大量的查询操作，但修改和删除操作很少，通常只需要定期的加载、刷新。
- 反映历史变化：数据仓库中的数据通常包含历史信息，系统记录了企业从过去某一时点（如开始应用数据仓库的时点）到目前的各个阶段的信息，通过这些信息，可以对企业的发展历程和未来趋势做出定量分析和预测。


### 数据仓库技术

数据仓库的结构通常包含四个层次，如下图所示：
1. 数据源：是数据仓库系统的基础，是整个系统的数据源泉。
2. 数据的存储与管理：是整个数据仓库系统的核心。
3. OLAP（联机分析处理）服务器：对分析需要的数据进行有效集成，按多维模型组织，以便进行多角度、多层次的分析，并发现趋势。
4. 前端工具：主要包括各种报表工具、查询工具、数据分析工具、数据挖掘工具以及各种基于数据仓库或数据集市的应用开发工具。

![](./5数据库技术基础/17.png)



### 商业智能

BI系统主要包括数据预处理、建立数据仓库、数据分析和数据展现四个主要阶段。

- 数据预处理是整合企业原始数据的第一步，它包括数据的抽取(Extraction)、转换(Transformation)和加载(Load)三个过程(ETL过程)
- 建立数据仓库则是处理海量数据的基础；
- 数据分析是体现系统智能的关键，一般采用联机分析处理(OLAP)和数据挖掘两大技术。联机分析处理不仅进行数据汇总/聚集，同时还提供切片、切块、下钻、上卷和旋转等数据分析功能，用户可以方便地对海量数据进行多维分析。数据挖掘的目标则是挖掘数据背后隐藏的知识，通过关联分析、聚类和分类等方法建立分析模型，预测企业未来发展趋势和将要面临的问题；
- 在海量数据和分析手段增多的情况下，数据展现侧主要保障系统分析结果的可视化。


## 反规范化技术

- 反规范化技术：规范化设计后，数据库设计者希望牺牲部分规范化来提高性能。
- 采用反规范化技术的益处：降低连接操作的需求、降低外码和索引的数目，还可能减少表的数目，能够提高查询效率。
- 可能带来的问题：数据的重复存储，浪费了磁盘空间；可能出现数据的完整性问题，为了保障数据的一致性，增加了数据维护的复杂性，会降低修改速度。
- 具体方法：
    - 增加冗余列：在多个表中保留相同的列，通过增加数据冗余减少或避免查询时的连接操作。
    - 增加派生列：在表中增加可以由本表或其它表中数据计算生成的列，减少查询时的连接操作并避免计算或使用集合函数。
    - 重新组表：如果许多用户需要查看两个表连接出来的结果数据，则把这两个表重新组成一个表来减少连接而提高性能。
    - 水平分割表：根据一列或多列数据的值，把数据放到多个独立的表中，主要用于表数据规模很大、表中数据相对独立或数据需要存放到多个介质上时使用。
    - 垂直分割表：对表进行分割，将主键与部分列放到一个表中，主键与其它列放到另一个表中，在查询时减少/O次数。


## 大数据
- 特点：大量化、多样化、价值密度低、快速化。
- 大数据和传统数据的比较如下：

比较维度|传统数据|大数据
--|--|--
数据量|GB或TB级|PB级或以上
数据分析需求|现有数据的分析与检测|深度分析(关联分析、回归分析)
硬件平台|高端服务器|集群平台



为了保证数据库中数据的安全可靠和正确有效，系统在进行事务处理时，对数据的插入、删除或修改的全部有关内容先写入）；当系统正常运行时，按一定的时间间隔，把数据库缓冲区内容写入（）；当发生故障时，根据现场数据内容及相关文件来恢复系统的状态。

A.索引文件  
B.数据文件  
C.日志文件  
D.数据字典

A.索引文件  
B.数据文件  
C.日志文件  
D.数据字典

答案：CB  
解析：在数据库中引入了日志文件，记录系统进行事务处理时的一切操作，但只记录操作内容，数据是存放在数据文件中，恢复现场时，依据日志文件可知有哪些操作，依据数据文件可知操作的数据是哪些。



数据仓库中数据（）的特点是指数据一旦进入数据仓库后，将被长期保留并定期加载和刷新，可以进行各种查询操作，但很少对数据进行修改和删除操作。

A.面向主题  
B.集成性  
C.相对稳定性  
D.反映历史变化

答案：C



## SQL语言
某销售公司数据库的零件关系P(零件号，零件名称，供应商，供应商所在地，库存量)，函数依赖集F={零件号→零件名称，(零件号，供应商)→库存量，供应商→供应商所在地}。零件关系P属于(54).查询各种零件的平均库存量、最多库存量与最少库存量之间差值的S0L语句如下：
```
SELECT零件号，(55)
FROM P
(56)
```

54、  
A.1NF  
B.2NF  
C.3NF  
D.4NF

55、  
A.AVG（库存量）AS平均库存量，MAX（库存量）一MIN（库存量）AS差值  
B.平均库存量AS AVG（库存量），差值AS MAX（库存量）一MIN（库存量）  
C,AVG库存量AS平均库存量，MAX库存量一MIN库存量AS差值  
D.平均库存量AS AVG库存量，差值AS MAXI库存量一MIN库存量

56、  
A.ORDER BY供应商  
B.ORDER BY零件号  
C.GROUP BY供应商  
D,GROUP BY零件号


答案：AAD

解析：依题意，基于函数依赖集F,零件P关系中的(零件号，供应商)可决定零件P关系的所有属性，因此零件P关系的主键为(零件号，供应商)。又因为“(零件号，供应商)→零件名称”，而“零件号→零件名称”、“供应商→供应商所在地”，由此可知零件名称和供应商所在地都部分依赖于码，所以关系模式P∈1NF.  
查询各种零件的平均库存量、最多库存量与最少库存量之间差值时，首先需要在结果列中的第一空缺处填入“AVG（库存量）AS平均库存量，MAX（库存量）一MIN（库存量）AS差值”。其次必须用分组语句按零件号分组，因第二空缺处应填入“GROUP BY零件号”。


若有关系R(ABCDE)和S(BCFG),则R和S自然连结运算后的属性列有(51)个，与表达式$\pi_{1,3,6,7}(\sigma_{3<6}(RooS))$
等价的SQL语句如下：`SELECT (52) FROM (53) WHERE (54)`


(51)  
A.5  
B.6  
C.7  
D.9


(52)  
A.A,R.C,F,G  
B.A,C,S.B,S.F  
C.A,C,S.B,S.C  
D.R.A,R.C,S.B,S.C

(53)  
A.R  
B.S  
C.RS  
D.R,S

(54)  
A.R.B=S.B AND R.C S.C AND R.C < S.B  
B.R.B=S.B AND R.C S.C AND R.C < S.F  
C.R.B=S.B OR R.C=S.C OR R.C < S.B  
D.R.B=S.B OR R.C=S.C OR R.C < S.F

答案：CADB

解析：自然连接后的属性列取两个表所有属性列，但相同属性列只显示一次，因此共7列；SELECT后是要查询显示的列，与投影m下标相同，将ABCDEFG七列从1开始编号，取第1,3,6,7列；FROM后面是要查询的表格，是R和S两张表，以逗号分开；WHERE后面是条件，自然连接取的是属性相同且值相同的记录，因此有R的B,Cc列与S的B,C列相等，表达式中的条件是第3列小于第6列，也加上














