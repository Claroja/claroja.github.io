## 数据库系统

- 数据：是数据库中存储的基本对象，是描述事物的符号记录。数据的种类：文本、图形、图像、音频、视频。
- 数据库DB:是长期存储在计算机内、有组织的、可共享的大量数据的集合。
- 数据库的基本特征：
    - 数据按一定的数据模型组织、描述和存储；
    - 可为各种用户共享；
    - 冗余度较小；
    - 数据独立性较高；
    - 易扩展。


- 数据库系统DBS:是一个采用了数据库技术，有组织地、动态地存储大量相关数据，方便多用户访问的计算机系统。其由下面四个部分组成：
    - 数据库(统一管理、长期存储在计算机内的，有组织的相关数据的集合)
    - 硬件（构成计算机系统包括存储数据所需的外部设备）
    - 软件(操作系统、数据库管理系统及应用程序)
    - 人员(系统分析和数据库设计人员、应用程序员、最终用户、数据库管理员DBA)
- 数据库管理系统DBMS的功能: 实现对共享数据有效的组织、管理和存取。包括数据定义、数据库操作、数据库运行管理、数据的存储管理、数据库的建立和维护等。




三种模式:
- 内模式：管理如何存储物理的数据，对应具体物理存储文件。
- 模式：又称为概念模式，就是我们通常使用的基本表，根据应用、需求将物理数据划分成一张张表。(完整的一张表)
- 外模式：对应数据库中的视图这个级别，将表进行一定的处理后再提供给用户使用.(一张表的部分查询的数据)


两种映射: 
- 外模式一模式映像：是表和视图之间的映射，存在于概念级和外部级之间，若表中数据发生了修改，只需要修改此映射，而无需修改应用程序。
- 模式一内模式映像：是表和数据的物理存储之间的映射，存在于概念级和内部级之间，若修改了数据存储方式，只需要修改此映射，而不需要去修改应用程序。

![](./软考_数据库技术基础/软考_数据库技术基础/1.png)



## 数据库设计 ❤️

1. 需求分析：即分析数据存储的要求，产出物有数据流图, 数据字典, 需求说明书。
2. 概念结构设计：就是设计E-R图，也即实体-属性图，与物理实现无关，说明有哪些实体，实体有哪些属性。
3. 逻辑结构设计：将E-R图，转换成关系模式，也即转换成实际的表和表中的列属性，这里要考虑很多规范化的东西。
4. 物理设计：根据生成的表等概念，生成物理数据库。


在数据库系统中，数据库的视图、基本表和存储文件的结构分别与（）对应：数据的物理独立性和数据的逻辑独立性是分别通过修改（）来完成的。  
A模式、外模式、内模式  
B模式、内模式、外模式  
C外模式、模式、内模式  
D.外模式、内模式、模式

A模式与内模式之间的映像、外模式与模式之间的映像  
B外模式与内模式之间的映像、外模式与模式之间的映像  
C外模式与模式之间的映像、模式与内模式之间的映像  
D.外模式与内模式之间的映像、模式与内模式之间的映像  

答案：CA

在数据库逻辑结构设计阶段，需要（）阶段形成的（）作为设计依据。  
A.需求分析  
B.概念结构设计  
C.物理结构设计  
D,数据库运行和维护  

A.程序文档、数据字典和数据流图。  
B.需求说明文档、程序文档和数据流图  
C.需求说明文档、数据字典和数据流图  
D.需求说明文档、数据字典和程序文档

答案：AC

## 数据模型

- 关系模型是二维表的形式表示的实体-联系模型，是将实体-联系模型转换而来的，经过开发人员设计的；
- 概念模型是从用户的角度进行建模的，是现实世界到信息世界的第一抽象，是真正的实体-联系模型。
- 网状模型表示实体类型及其实体之间的联系，一个事物和另外几个都有联系，形成一张网。
- 面向对象模型是采用面向对象的方法设计数据库，以对象为单位，每个对象包括属性和方法，具有类和继承等特点。
- 数据模型三要亲：`数据结构`（所研究的对象类型的集合）、`数据操作`（对数据库中各种对象的实例允许执行的操作的集合）、`数据的约束条件`（一组完整性规则的集合）。




- 用E-R图来描述概念数据模型，世界是由一组称作实体的基本对象和这些对象之间的联系构成的。
- 在E-R模型中，使用椭圆表示属性（一般没有）、长方形表示实体(长方形加两条杠是弱实体)、菱形表示联系，联系的两端要填写联系类型(一对一,一对多, 多对多)，示例如下图：


![](./软考_数据库技术基础/软考_数据库技术基础/2.png)


- 实体：客观存在并可相互区别的事物。可以是具体的人、事、物或抽象概念。如人、汽车、图书、账户、贷款。
- 弱实体和强实体：弱实体依赖于强实体的存在而存在。强实体和弱实体的关系使用小圆圈表示, 比如经理是弱实体, 员工是强实体, 表示经理也是员工的一种.
- 实体集：具有相同类型和共享相同属性的实体的集合，如学生、课程。
- 属性：实体所具有的特性。
- 属性分类：简单属性和复合属性；单值属性和多值属性；NULL属性；派生属性(通过身份证找出生日)。
- 域：属性的取值范围称为该属性的域。
- 码(key):唯一标识实体的属性集。
- 联系：现实世界中事物内部以及事物之间的联系，在E-图中反映为实体内部的联系和实体之间的联系。
- 联系类型：一对一1:1、一对多1:N、多对多M:N。

- 两个以上实体型关系:

    ![](./软考_数据库技术基础/软考_数据库技术基础/3.png)

    教师使用参考书教授课程
    一个课程多个教师教授, 一个课程可以由多种参考书


- 关系模型中数据的逻辑结构是一张二维表）由行列组成。用表格结构表达实体集，用外键标识实体间的联系。如下图：

    ![](./软考_数据库技术基础/软考_数据库技术基础/4.png)


    优点：建立在严格的数学概念基础上：概念单一、结构简单、清晰，用户易懂易用；存取路径对用户透明，从而数据独立性、安全性好，简化数据库开发工作。  
    缺点：由于存取路径透明，查询效率往往不如非关系数据模型。



- E-模型转换为关系模型：`每个实体都对应一个关系模式`, 联系分为三种：

    - 1:1联系中，联系可以放到任意的两端实体中，作为一个属性（要保证1:1的两端关联），也可以转换为一个单独的关系模式：
    - 1:N的联系中，联系可以单独作为一个关系模式，也可以在N端中加入1端实体的主键；
    - M:N的联系中，联系必须作为一个单独的关系模式，其主键是M和N端的联合主键。


题目:

某本科高校新建教务管理系统，支撑各学院正常的教学教务管理工作。经过初步分析，系统中包含的实体有学院、教师、学生、课程等。考虑需要将本科学生的考试成绩及时通报给学生家长，新增家长实体；考虑到夜大、网络教育学生管理方式的不同，需要额外的管理数据，新增进修学生实体：规定一个学生可以选择多门课程，每门课程可以被多名学生选修；一个教师可以教授多门课程，一门课程只能被一名教师讲授。（）实体之间为多对多联系，（）属于弱实体对强实体的依赖联系。

A、学生、学院  
B、教师、学院  
C、学生、课程  
D、教师、课程

A、家长、学生  
B、学生、教师  
C、学生、学院  
D、教师、学院

答案：CA  
解析：一个学生可以选择多门课程，每门课程可以被多名学生选修，因此学生和课程是多对多。
弱实体依赖于强实体的存在而存在，只有学生存在，其家长信息才会存在，否则单独的家长信息无意义。


54-56.部门、员工和项目的关系模式及它们之间的E-图如下所示，其中关系模式中带实下划线的属性表示主键属性。图中：  
- 部门(部门代码，部门名称，电话)
- 员工(员工代码，姓名，部门代码，联系方式，薪资)
- 项目(项目编号，项目名称，承担任务)

![](./软考_数据库技术基础/软考_数据库技术基础/5.png)

若部门和员工关系进行自然连接运算，其结果为(54)元关系。由于员工和项目之间的联系类型为(55)，所以员工和项目之间的联系需要转换成一个独立的关系模式，该关系模式的主键是(56).

(54)  
A.5  
B.6  
C.7  
D.8

(55)  
A.1对1  
B.1对多  
C.多对1  
D.多对多

(56)  
A.(项目名称，员工代码)  
B.(项目编号，员工代码)  
C.(项目名称，部门代码)  
D.(项目名称，承担任务)  

答案：CDB





## 关系代数
- 并：结果是两张表中所有记录数合并，相同记录只显示一次。
- 交：结果是两张表中相同的记录。
- 差：$S1-S2$,结果是51表中有而S2表中没有的那些记录。


    ![](./软考_数据库技术基础/软考_数据库技术基础/6.png)


- 笛卡尔积：$S1 \times S2$,产生的结果包括S1和S2的所有属性列，并且S1中每条记录依次和S2中所有记录组合成一条记录，最终属性列为S1+S2属性列，记录数为$S1 \times S2$记录数。
- 投影：实际是按条件选择某关系模式中的某列，列也可以用数字表示。$\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列
- 选择：实际是按条件选择某关系模式中的某条记录。$\sigma_{3=5 \land 4 = 6}$: 是选择操作, 选择第3列和第5列值相等且第4列和第6列值相等的行


    ![](./软考_数据库技术基础/软考_数据库技术基础/7.png)


- 自然连接的结果显示全部的属性列，但是相同属性列只显示一次，显示两个关系模式中属性相同且值相同的记录。设有关系R、S如下左图所示，自然连接结果如下右图所示：

    ![](./软考_数据库技术基础/软考_数据库技术基础/8.png)


给定关系$R(A, B, C, D)$和关系$S(C, D, E)$, 对其进行自然连接运算$R \bowtie S$后的属性列为()个;  
与$\sigma_{R.B>S.E}(R \bowtie S)$等价的关系代数表达式为().

A.$\sigma_{2>7}(R \times S)$  
B.$\pi_{1,2,3,4,7}(\sigma_{'2'>'7' \land 3=5 \land 4=6}(R \times S))$  
C.$\sigma_{'2'>'7'}(R \times S)$  
D.$\pi_{1,2,3,4,7}(\sigma_{2>7 \land 3=5 \land 4=6}(R \times S))$  

答案: D

- $R(A, B, C, D)$: $R$是表的名字, $ABCD$是列名.
- $R \bowtie S$: 是自然连接运算, 结果是$S \bowtie R = (ABCDE)$
- $R \times S$: 是笛卡尔积连接运算, 结果是$S \times R = (ABCDCDE)$
- $\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列
- $\sigma_{3=5 \land 4 = 6}$: 是选择操作, 选择第3列和第5列值相等且第4列和第6列值相等的行
- $\land$: 是逻辑且

$\pi_{1,2,3,4,7}(\sigma_{2>7 \land 3=5 \land 4=6}(R \times S))$的意思是:
1. 对$R和S$进行笛卡尔积计算, 列的结果是: $S \times R = (ABCDCDE)$, 对应列的编号是$(1234567)$
2. 对上一步结果进行选择操作: $\sigma_{2>7 \land 3=5 \land 4=6}$, 即取第2列大于第7列且第3列等于第5列且第4列等于第6列的行
    1. CD列相同的行, $\sigma_{3=5 \land 4 = 6}$. 序号是笛卡尔连接结果对应的下标$(ABCDCDE)(1234567)$
    2. 题目中自然连接$\sigma_{R.B>S.E}$的条件,对应笛卡尔积的为 $\sigma_{2>7}$
    3. 将上面两个条件合并$\sigma_{2>7 \land 3=5 \land 4 = 6}$
3. 对上一步记过进行投影操作: $\pi_{1,2,3,4,7}$: 是投影操作, 表示选择1,2,3,4,7列

上面的笛卡尔积变换公式和自然连接公式等价: $\sigma_{R.B>S.E}(R \bowtie S)$



## 函数依赖
- 给定一个X,能唯一确定一个Y,就称x确定Y,或者说Y依赖于X,例如Y=X*X函数。

函数依赖又可扩展以下两种规则：
- 部分函数依赖：A可确定C,(A,B)也可确定C,(A,B)中的一部分(即A)可以确定C,称为部分函数依赖。
- 传递函数依赖：当A和B不等价时，A可确定B,B可确定C,则A可确定C,是传递函数依赖；若A和B等价，则不存在传递，直接就可确定C。


![](./软考_数据库技术基础/软考_数据库技术基础/9.png)


- 函数依赖的公理系统(Armstrong)

    设关系模式$R<U,F>$,$U$是关系模式$R$的属性全集，$F$是关系模式$R$的一个函数依赖集。对于$R<U,F>$来说有以下的：

    - 自反律：若$Y \subseteq X \subseteq U$,则X→Y为F所逻辑蕴含
    - 增广律：若X→Y为F所逻辑蕴含，且ZCU,则X2→YZ为F所逻辑蕴含
    - 传递律：若X→Y和Y→Z为F所逻辑蕴含，则x→Z为F所逻辑蕴含
    - 合并规则：若X→Y,X→Z,则X→YZ为F所蕴涵
    - 伪传递率：若X→Y,WN→Z,则XW→Z为F所蕴涵
    - 分解规则：若x→Y,$Z \subseteq Y$,则X→Z为所蕴涵


## 键与约束

- 超键：能唯一标识此表的属性的组合。
- 侯选键：超键中去掉冗余的属性，剩余的属性就是侯选键。(比如学号, 身份证号都可以唯一标识)
- 主键：任选一个侯选键，即可作为主键
- 外键：其他表中的主键
- 主属性：候选键内的属性为主属性，其他属性为非主属性。

约束

- 实体完整性约束：即主键约束，主键值不能为空，也不能重复。
- 参照完整性约束：即外键约束，外键必须是其他表中已经存在的主键的值，或者为空
- 用户自定义完整性约束：自定义表达式约束，如设定年龄属性的值必须在0到150之间。



## 范式

- 第一范式1NF
    关系中的每一个分量必须是一个不可分的数据项。通俗地说，第一范式就是表中不允许有小表的存在。比如，对于如下的员工表，就不属于第一范式：


    ![](./软考_数据库技术基础/软考_数据库技术基础/10.png)

    - 实例：用一个单一的关系模式学生来描述学校的教务系统：学生（学号，学生姓名，系号，系主任姓名，课程号，成绩）
    - 依赖关系（学号->学生姓名，学号>系号，系号>系主任姓名，学号>课程号，(学号，课程号)>成绩）


    ![](./软考_数据库技术基础/软考_数据库技术基础/11.png)

    学号有重复, 不能唯一标识. 使用(学号,课程号)做联合主键.

- 第二范式

    如果关系R属于1NF,且每一个非主属性完全函数依赖于任何一个候选码，则R属于2NF.
    通俗地说，2NF就是在1NF的基础上，表中的每一个非主属性不会依赖复合主键中的某一个列。只存在多个属性的主键中.
    按照定义，上面的学生表就不满足2NF，因为学号不能完全确定课程号和成绩（每个学生可以选多门课）。
    将学生表分解为：
    - 学生(学号，学生姓名，系编号，系名，系主任)
    - 选课(学号，课程号，成绩)。
    每张表均属于2NF。

- 第三范式
    在满足1NF的基础上，表中不存在非主属性对码的传递依赖。

    继续上面的实例，学生关系模式就不属于3NF,因为学生无法直接决定系主任和系名，是由学号->系编号，再由系编号>系主任，系编号->系名，因此存在非主属性对主属性的传递依赖，

    将学生表进一步分解为：
    - 学生(学号，学生姓名，系编号)
    - 系(系编号，系名，系主任)
    - 选课(学号，课程号，成绩)

    每张表都属于3NF。




- BC范式BCNF，是指在第三范式的基础上进一步消除主属性对于码的部分函数依赖和传递依赖。
- 通俗的来说，就是在每一种情况下，每一个依赖的左边决定因素都必然包含候选键，如下：

![](./软考_数据库技术基础/软考_数据库技术基础/12.png)

- 上图中，候选键有两种情况：组合键(S,T)或者(S,J),依赖集为{SJ一T,T一J}可知，STJ三个属性都是主属性，因此其达到了3NF（无非主属性），然而，第二种情况，即(S,J)为候选键的时候，对于依赖T->J,T在这种情况不是候选键，即T-J的决定因素不包含任意候选码，因此上图不是BCNF.
- 要使上图关系模式转换为BCNF也很简单，只需要将依赖T->J变为TS->J即可，这样其左边决定因素就包含了候选键之一S。



给定关系模式R(U,F),U={A,B,C,D},F={AB→C,CD→B}。关系R（）,且分别有（）。  
A.只有1个候选关键字ACB  
B.只有1个候选关键字BCD  
C.有2个候选关键字ACD和ABD  
D.有2个候选关键字ACB和BCD


A.0个非主属性和4个主属性  
B.1个非主属性和3个主属性  
C.2个非主属性和2个主属性  
D.3个非主属性和1个主属性

候选关键字的求法：根据依赖集，找出`从未在右边出现过的属性，必然是候选键之一`，以该属竹为基础，根据依赖集依次扩展，`看能否遍历所有属性`，将无法遍历的加入候选键中。
答案：CA



设有关系模式R(E,N,M,L,Q),其函数依赖集为F={E→N,EM→Q,M→L}。则关系模式R达到了()；该关系模式();

A.1NF  
B.2NF  
C.3NF  
D.BCNF  

A.无需进行分解，因为已经达到了3NF  
B.无需进行分解，因为已经达到了BCNF  
C.尽管不存在部分函数依赖，但还存在传递依赖，所以需要进行分解  
D.需要进行分解，因为存在冗余、修改操作的不一致性、插入和删除异常  